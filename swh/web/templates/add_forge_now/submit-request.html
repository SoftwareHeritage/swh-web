{% extends "../layout.html" %}

{% comment %}
Copyright (C) 2021  The Software Heritage developers
See the AUTHORS file at the top-level directory of this distribution
License: GNU Affero General Public License version 3, or any later version
See top-level LICENSE file for more information
{% endcomment %}

{% load render_bundle from webpack_loader %}
{% load static %}

{% block title %}{{ heading }} &ndash; Software Heritage archive{% endblock %}

{% block header %}
{% endblock %}

{% block navbar-content %}
<h4>Add forge now</h4>
{% endblock %}

{% block content %}

<form method="POST" action="/api/1/add-forge/request/create" id="submitform">
    {% csrf_token %}
    <div class="form-row">
        <div class="col-md-1"></div>
        <div class="form-group col-md-2">
            <label for="swh-input-forge-type">Forge type</label>
            {{ request_form.forge_type }}
        </div>
        <div class="form-group col-md-3">
            <label for="swh-input-forge-url">Forge url</label>
            {{ request_form.forge_url }}
        </div>
    </div>

    <div class="form-row">
        <div class="col-md-1"></div>
        <div class="form-group col-md-2">
            <label for="swh-input-forge-contact-name">Forge contact name</label>
            {{ request_form.forge_contact_name }}
        </div>

        <div class="form-group col-md-2">
            <label for="swh-input-forge-contact-email">Forge contact email</label>
            {{ request_form.forge_contact_email }}
        </div>
    </div>

    <div class="form-row">
        <div class="col-md-1"></div>
        <div class="form-group col-md-2">
            <label for="swh-input-forge-comment">Comment</label>
            {{ request_form.forge_contact_comment }}
        </div>
    </div>

    <input type="submit" value="Submit">
    <p id="userMessage"></p>
</form>

<script type="text/javascript">
 $(document).ready(() => {
     $( "#submitform" ).submit(function(event) {
         event.preventDefault();
         $.ajax({
             data: $(this).serialize(),
             type: $(this).attr('method'),
             url: $(this).attr('action'),
             success: function(response) {
                 $("#userMessage").text("Your request has been submitted")
             },
             error: function(request, status, error) {
                 $("#userMessage").text("Some unknown error happened")
             }
         });
     });
 });
</script>

{% endblock %}
