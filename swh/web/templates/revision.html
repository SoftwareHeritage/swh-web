{% extends "browse.html" %}

{% load static %}
{% load swh_templatetags %}
{% load render_bundle from webpack_loader %}

{% block header %}
  {{ block.super }}
  {% render_bundle 'revision' %}
{% endblock %}

{% block swh-browse-before-panels %}
{% if snapshot_context %}
  {% include "includes/snapshot-context.html" %}
{% endif %}
{% endblock %}

{% block swh-browse-main-panel-content %}
<div style="height: 35px;margin: 4px;">
<i class="octicon octicon-git-commit fa-fw"></i>Revision <b>{{ swh_object_metadata.id }}</b>
authored by {{ swh_object_metadata.author }} on <b>{{ swh_object_metadata.date }}</b>
</div>

<div class="panel panel-default" style="overflow-x: auto;">
  <div class="panel-heading" style="padding: 10px">
    <a data-toggle="collapse" id="swh-collapse-revision-message" href="#swh-revision-message">
      <div class="pull-left">
        <pre style="white-space: pre-wrap; background-color: inherit; padding: 0px; margin: 0px; border: none;"><h2 style="padding-bottom: 0px;">{{ message_header }}</h2></pre>
      </div>
      <div class="clearfix"></div>
    </a>
  </div>

  <div id="swh-revision-message" class="panel-collapse collapse">
    <pre style="white-space: pre-wrap; margin: 0px; border: none; border-radius: 0px;">{{ message_body }}</pre>
  </div>
</div>

<div style="margin: 4px; padding-bottom: 5px;">
{{ parents_links }}
</div>

<ul class="nav nav-tabs" style="padding-left: 5px;">
  <li class="active"><a data-toggle="tab" href="#swh-revision-tree">Files</a></li>
  <li><a data-toggle="tab" href="#swh-revision-changes">Changes</a></li>
</ul>

<div class="tab-content">
  <div id="swh-revision-tree" class="tab-pane active">

    {% include "includes/top-navigation.html" %}

    {% if content_size %}

    {% include "includes/content-display.html" %}

    {% else %}

    {% include "includes/directory-display.html" %}

    {% endif %}
  </div>
  <div id="swh-revision-changes" class="tab-pane">

    <div id="swh-too-large-revision-diff" class="alert alert-warning" role="alert" style="display: none; margin: 5px 5px 0px 5px">
      The diff you're trying to view is too large. Only the first <span id="swh-nb-loaded-diffs">1000</span> changed files have been loaded.
    </div>

    <div id="swh-revision-diffs" class="panel-group" style="padding: 5px;">

      <div class="panel panel-default" style="overflow-x: auto;">
        <div class="panel-heading">
          <a data-toggle="collapse" href="#swh-revision-changes-list">
            <div class="pull-left">
              Showing <strong id="swh-revision-changed-files"></strong>
              with <strong id="swh-revision-lines-added" style="color:green">0 additions</strong>
              and <strong id="swh-revision-lines-deleted" style="color:red">0 deletions</strong>
              (<span id="swh-nb-diffs-computed">0</span> / <span id="swh-total-nb-diffs">0</span> diffs computed)
            </div>
            <div class="pull-right">
              <button class="btn btn-md btn-swh" type="button" onclick="swh.revision.compute_all_diffs(event)" id="swh-compute-all-diffs"
                      title="By default, diffs will be computed as the view is scrolled.
Pushing that button will request the immediate computation of all diffs." style="visibility: hidden;">Compute all diffs</button>
            </div>
            <div class="clearfix"></div>
          </a>
        </div>
        <div id="swh-revision-changes-list" class="panel-collapse collapse in">
          <div id="swh-revision-changes-loading" style="text-align: center">
            <img src="{% static "img/swh-spinner.gif" %}"></img>
            <p>Computing file changes ...</p>
          </div>
          <pre style="background: none; border: none;display: none;"></pre>
        </div>
      </div>
  </div>

</div>

<script>
  var revMsgBody = {{ message_body|jsonify }};
  var diffRevUrl = {{ diff_revision_url|jsonify }};
  swh.revision.initRevisionDiff(revMsgBody, diffRevUrl);
</script>

{% endblock %}

{% block swh-browse-after-panels %}
  {% include "includes/readme-display.html" %}
{% endblock %}
