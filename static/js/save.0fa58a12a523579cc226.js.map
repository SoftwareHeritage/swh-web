{"version":3,"sources":["webpack://swh.save/webpack/universalModuleDefinition","webpack://swh.save/./assets/src/utils/constants.js","webpack://swh.save/./assets/src/utils/functions.js","webpack://swh.save/webpack/bootstrap","webpack://swh.save/webpack/runtime/define property getters","webpack://swh.save/webpack/runtime/hasOwnProperty shorthand","webpack://swh.save/webpack/runtime/make namespace object","webpack://swh.save/./assets/src/bundles/save/index.js"],"names":["root","factory","exports","module","define","amd","self","swhSpinnerSrc","staticAsset","handleFetchError","response","ok","asset","__STATIC__","csrfPost","url","headers","body","Cookies","get","fetch","credentials","method","isGitRepoUrl","pathPrefix","undefined","find","protocol","pathname","startsWith","RegExp","test","slice","length","removeUrlFragment","history","replaceState","document","title","window","location","search","htmlAlert","type","message","closable","closeButton","extraClasses","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","__webpack_modules__","d","definition","key","o","Object","defineProperty","enumerable","obj","prop","prototype","hasOwnProperty","call","r","Symbol","toStringTag","value","saveRequestsTable","originSaveRequest","originType","originUrl","extraData","acceptedCallback","pendingCallback","errorCallback","addSaveOriginRequestUrl","Urls","api_1_save_origin","$","css","JSON","stringify","then","json","data","save_request_status","errorData","status","maybeRequireExtraInputs","cssDisplay","disabled","val","initOriginSave","ready","fn","dataTable","ext","errMode","origin_save_types_list","append","on","e","settings","techNote","text","console","log","DataTable","serverSide","processing","language","ajax","origin_save_requests_list","swh","webapp","isUserLoggedIn","user_requests_only","searchDelay","dom","fnInitComplete","html","draw","columns","name","render","row","Date","toLocaleString","sanitizedURL","display","save_task_status","browseOriginUrl","browse_origin","encodeURIComponent","visit_date","id","visit_type","origin_url","scrollY","scrollCollapse","order","responsive","details","addJumpToPagePopoverToDataTable","hash","popover","saveRequestAcceptedAlert","saveRequestPendingAlert","saveRequestRateLimitedAlert","saveRequestUnknownErrorAlert","submit","event","preventDefault","stopPropagation","alert","target","checkValidity","removeClass","statusCode","errorAlert","addClass","tab","this","trim","each","includes","validateSaveOriginUrl","input","validUrl","URL","TypeError","hostname","setCustomValidity","initTakeNewSnapshot","newSnapshotRequestAcceptedAlert","newSnapshotRequestPendingAlert","newSnapshotRequestRateLimitAlert","newSnapshotRequestUnknownErrorAlert","formatValuePerType","v","displaySaveRequestInfo","saveRequestId","saveRequestTaskInfoUrl","origin_save_task_info","animation","boundary","container","content","placement","sanitizeFn","filterXSS","popoverId","attr","click","saveRequestTaskInfo","isEmptyObject","saveRequestInfo","entries","property","push","info","fillSaveRequestFormAndScroll","visitType","originTypeFound","scrollTo"],"mappings":"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","file":"js/save.0fa58a12a523579cc226.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"swh\"] = factory();\n\telse\n\t\troot[\"swh\"] = root[\"swh\"] || {}, root[\"swh\"][\"save\"] = factory();\n})(self, function() {\nreturn ","/**\n * Copyright (C) 2019  The Software Heritage developers\n * See the AUTHORS file at the top-level directory of this distribution\n * License: GNU Affero General Public License version 3, or any later version\n * See top-level LICENSE file for more information\n */\n\nimport {staticAsset} from 'utils/functions';\n\n// Constants defining Bootstrap Breakpoints\nexport const BREAKPOINT_SM = 768;\nexport const BREAKPOINT_MD = 992;\nexport const BREAKPOINT_LG = 1200;\n\nexport const swhSpinnerSrc = staticAsset('img/swh-spinner.gif');\n","/**\n * Copyright (C) 2018-2020  The Software Heritage developers\n * See the AUTHORS file at the top-level directory of this distribution\n * License: GNU Affero General Public License version 3, or any later version\n * See top-level LICENSE file for more information\n */\n\n// utility functions\n\nexport function handleFetchError(response) {\n  if (!response.ok) {\n    throw response;\n  }\n  return response;\n}\n\nexport function handleFetchErrors(responses) {\n  for (let i = 0; i < responses.length; ++i) {\n    if (!responses[i].ok) {\n      throw responses[i];\n    }\n  }\n  return responses;\n}\n\nexport function staticAsset(asset) {\n  return `${__STATIC__}${asset}`;\n}\n\nexport function csrfPost(url, headers = {}, body = null) {\n  headers['X-CSRFToken'] = Cookies.get('csrftoken');\n  return fetch(url, {\n    credentials: 'include',\n    headers: headers,\n    method: 'POST',\n    body: body\n  });\n}\n\nexport function isGitRepoUrl(url, pathPrefix = '/') {\n  let allowedProtocols = ['http:', 'https:', 'git:'];\n  if (allowedProtocols.find(protocol => protocol === url.protocol) === undefined) {\n    return false;\n  }\n  if (!url.pathname.startsWith(pathPrefix)) {\n    return false;\n  }\n  let re = new RegExp('[\\\\w\\\\.-]+\\\\/?(?!=.git)(?:\\\\.git\\\\/?)?$');\n  return re.test(url.pathname.slice(pathPrefix.length));\n};\n\nexport function removeUrlFragment() {\n  history.replaceState('', document.title, window.location.pathname + window.location.search);\n}\n\nexport function selectText(startNode, endNode) {\n  let selection = window.getSelection();\n  selection.removeAllRanges();\n  let range = document.createRange();\n  range.setStart(startNode, 0);\n  if (endNode.nodeName !== '#text') {\n    range.setEnd(endNode, endNode.childNodes.length);\n  } else {\n    range.setEnd(endNode, endNode.textContent.length);\n  }\n  selection.addRange(range);\n}\n\nexport function htmlAlert(type, message, closable = false) {\n  let closeButton = '';\n  let extraClasses = '';\n  if (closable) {\n    closeButton =\n      `<button type=\"button\" class=\"close\" data-dismiss=\"alert\" aria-label=\"Close\">\n        <span aria-hidden=\"true\">&times;</span>\n      </button>`;\n    extraClasses = 'alert-dismissible';\n  }\n  return `<div class=\"alert alert-${type} ${extraClasses}\" role=\"alert\">${message}${closeButton}</div>`;\n}\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define getter functions for harmony exports\n__webpack_require__.d = function(exports, definition) {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = function(obj, prop) { return Object.prototype.hasOwnProperty.call(obj, prop); }","// define __esModule on exports\n__webpack_require__.r = function(exports) {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","/**\n * Copyright (C) 2018-2021  The Software Heritage developers\n * See the AUTHORS file at the top-level directory of this distribution\n * License: GNU Affero General Public License version 3, or any later version\n * See top-level LICENSE file for more information\n */\n\nimport {csrfPost, handleFetchError, isGitRepoUrl, htmlAlert, removeUrlFragment} from 'utils/functions';\nimport {swhSpinnerSrc} from 'utils/constants';\n\nlet saveRequestsTable;\n\nfunction originSaveRequest(\n  originType, originUrl, extraData,\n  acceptedCallback, pendingCallback, errorCallback\n) {\n  // Actually trigger the origin save request\n  let addSaveOriginRequestUrl = Urls.api_1_save_origin(originType, originUrl);\n  $('.swh-processing-save-request').css('display', 'block');\n  let headers = {};\n  let body = null;\n  if (extraData !== {}) {\n    body = JSON.stringify(extraData);\n    headers = {\n      'Content-Type': 'application/json'\n    };\n  };\n\n  csrfPost(addSaveOriginRequestUrl, headers, body)\n    .then(handleFetchError)\n    .then(response => response.json())\n    .then(data => {\n      $('.swh-processing-save-request').css('display', 'none');\n      if (data.save_request_status === 'accepted') {\n        acceptedCallback();\n      } else {\n        pendingCallback();\n      }\n    })\n    .catch(response => {\n      $('.swh-processing-save-request').css('display', 'none');\n      response.json().then(errorData => {\n        errorCallback(response.status, errorData);\n      });\n    });\n}\n\nexport function maybeRequireExtraInputs() {\n  // Read the actual selected value and depending on the origin type, display some extra\n  // inputs or hide them. This makes the extra inputs disabled when not displayed.\n  const originType = $('#swh-input-visit-type').val();\n  let cssDisplay;\n  let disabled;\n\n  if (originType === 'archives') {\n    disabled = false;\n    cssDisplay = 'flex';\n  } else {\n    cssDisplay = 'none';\n    disabled = true;\n  }\n  $('#optional-origin-forms').css('display', cssDisplay);\n  $('#swh-input-artifact-url').prop('disabled', disabled);\n  $('#swh-input-artifact-version').prop('disabled', disabled);\n}\n\nconst userRequestsFilterCheckbox = `\n<div class=\"custom-control custom-checkbox swhid-option\">\n  <input class=\"custom-control-input\" value=\"option-user-requests-filter\" type=\"checkbox\"\n         id=\"swh-save-requests-user-filter\">\n  <label class=\"custom-control-label font-weight-normal\" for=\"swh-save-requests-user-filter\">\n    show only your own requests\n  </label>\n</div>\n`;\n\nexport function initOriginSave() {\n\n  $(document).ready(() => {\n\n    $.fn.dataTable.ext.errMode = 'none';\n\n    fetch(Urls.origin_save_types_list())\n      .then(response => response.json())\n      .then(data => {\n        for (let originType of data) {\n          $('#swh-input-visit-type').append(`<option value=\"${originType}\">${originType}</option>`);\n        }\n        // set git as the default value as before\n        $('#swh-input-visit-type').val('git');\n      });\n\n    saveRequestsTable = $('#swh-origin-save-requests')\n      .on('error.dt', (e, settings, techNote, message) => {\n        $('#swh-origin-save-request-list-error').text('An error occurred while retrieving the save requests list');\n        console.log(message);\n      })\n      .DataTable({\n        serverSide: true,\n        processing: true,\n        language: {\n          processing: `<img src=\"${swhSpinnerSrc}\"></img>`\n        },\n        ajax: {\n          url: Urls.origin_save_requests_list('all'),\n          data: (d) => {\n            if (swh.webapp.isUserLoggedIn() && $('#swh-save-requests-user-filter').prop('checked')) {\n              d.user_requests_only = '1';\n            }\n          }\n        },\n        searchDelay: 1000,\n        // see https://datatables.net/examples/advanced_init/dom_toolbar.html and the comments section\n        // this option customizes datatables UI components by adding an extra checkbox above the table\n        // while keeping bootstrap layout\n        dom: '<\"row\"<\"col-sm-3\"l><\"col-sm-6 text-left user-requests-filter\"><\"col-sm-3\"f>>' +\n             '<\"row\"<\"col-sm-12\"tr>>' +\n             '<\"row\"<\"col-sm-5\"i><\"col-sm-7\"p>>',\n        fnInitComplete: function() {\n          if (swh.webapp.isUserLoggedIn()) {\n            $('div.user-requests-filter').html(userRequestsFilterCheckbox);\n            $('#swh-save-requests-user-filter').on('change', () => {\n              saveRequestsTable.draw();\n            });\n          }\n        },\n        columns: [\n          {\n            data: 'save_request_date',\n            name: 'request_date',\n            render: (data, type, row) => {\n              if (type === 'display') {\n                let date = new Date(data);\n                return date.toLocaleString();\n              }\n              return data;\n            }\n          },\n          {\n            data: 'visit_type',\n            name: 'visit_type'\n          },\n          {\n            data: 'origin_url',\n            name: 'origin_url',\n            render: (data, type, row) => {\n              if (type === 'display') {\n                let html = '';\n                const sanitizedURL = $.fn.dataTable.render.text().display(data);\n                if (row.save_task_status === 'succeeded') {\n                  let browseOriginUrl = `${Urls.browse_origin()}?origin_url=${encodeURIComponent(sanitizedURL)}`;\n                  if (row.visit_date) {\n                    browseOriginUrl += `&amp;timestamp=${encodeURIComponent(row.visit_date)}`;\n                  }\n                  html += `<a href=\"${browseOriginUrl}\">${sanitizedURL}</a>`;\n                } else {\n                  html += sanitizedURL;\n                }\n                html += `&nbsp;<a href=\"${sanitizedURL}\"><i class=\"mdi mdi-open-in-new\" aria-hidden=\"true\"></i></a>`;\n                return html;\n              }\n              return data;\n            }\n          },\n          {\n            data: 'save_request_status',\n            name: 'status'\n          },\n          {\n            data: 'save_task_status',\n            name: 'loading_task_status'\n          },\n          {\n            name: 'info',\n            render: (data, type, row) => {\n              if (row.save_task_status === 'succeeded' || row.save_task_status === 'failed') {\n                return `<i class=\"mdi mdi-information-outline swh-save-request-info\" ` +\n                       'aria-hidden=\"true\" style=\"cursor: pointer\"' +\n                       `onclick=\"swh.save.displaySaveRequestInfo(event, ${row.id})\"></i>`;\n              } else {\n                return '';\n              }\n            }\n          },\n          {\n            render: (data, type, row) => {\n              if (row.save_request_status === 'accepted') {\n                const saveAgainButton =\n                  '<button class=\"btn btn-default btn-sm swh-save-origin-again\" type=\"button\" ' +\n                  `onclick=\"swh.save.fillSaveRequestFormAndScroll(` +\n                  `'${row.visit_type}', '${row.origin_url}');\">` +\n                  '<i class=\"mdi mdi-camera mdi-fw\" aria-hidden=\"true\"></i>' +\n                  'Save again</button>';\n                return saveAgainButton;\n              } else {\n                return '';\n              }\n            }\n          }\n        ],\n        scrollY: '50vh',\n        scrollCollapse: true,\n        order: [[0, 'desc']],\n        responsive: {\n          details: {\n            type: 'none'\n          }\n        }\n      });\n\n    swh.webapp.addJumpToPagePopoverToDataTable(saveRequestsTable);\n\n    $('#swh-origin-save-requests-list-tab').on('shown.bs.tab', () => {\n      saveRequestsTable.draw();\n      window.location.hash = '#requests';\n    });\n\n    $('#swh-origin-save-request-help-tab').on('shown.bs.tab', () => {\n      removeUrlFragment();\n      $('.swh-save-request-info').popover('dispose');\n    });\n\n    let saveRequestAcceptedAlert = htmlAlert(\n      'success',\n      'The \"save code now\" request has been accepted and will be processed as soon as possible.',\n      true\n    );\n\n    let saveRequestPendingAlert = htmlAlert(\n      'warning',\n      'The \"save code now\" request has been put in pending state and may be accepted for processing after manual review.',\n      true\n    );\n\n    let saveRequestRateLimitedAlert = htmlAlert(\n      'danger',\n      'The rate limit for \"save code now\" requests has been reached. Please try again later.',\n      true\n    );\n\n    let saveRequestUnknownErrorAlert = htmlAlert(\n      'danger',\n      'An unexpected error happened when submitting the \"save code now request\".',\n      true\n    );\n\n    $('#swh-save-origin-form').submit(event => {\n      event.preventDefault();\n      event.stopPropagation();\n      $('.alert').alert('close');\n      if (event.target.checkValidity()) {\n        $(event.target).removeClass('was-validated');\n        let originType = $('#swh-input-visit-type').val();\n        let originUrl = $('#swh-input-origin-url').val();\n\n        // read the extra inputs for the 'archives' type\n        let extraData = originType !== 'archives' ? {} : {\n          'artifact_url': $('#swh-input-artifact-url').val(),\n          'artifact_version': $('#swh-input-artifact-version').val()\n        };\n\n        originSaveRequest(originType, originUrl, extraData,\n                          () => $('#swh-origin-save-request-status').html(saveRequestAcceptedAlert),\n                          () => $('#swh-origin-save-request-status').html(saveRequestPendingAlert),\n                          (statusCode, errorData) => {\n                            $('#swh-origin-save-request-status').css('color', 'red');\n                            if (statusCode === 403) {\n                              const errorAlert = htmlAlert('danger', `Error: ${errorData['reason']}`);\n                              $('#swh-origin-save-request-status').html(errorAlert);\n                            } else if (statusCode === 429) {\n                              $('#swh-origin-save-request-status').html(saveRequestRateLimitedAlert);\n                            } else if (statusCode === 400) {\n                              const errorAlert = htmlAlert('danger', errorData['reason']);\n                              $('#swh-origin-save-request-status').html(errorAlert);\n                            } else {\n                              $('#swh-origin-save-request-status').html(saveRequestUnknownErrorAlert);\n                            }\n                          });\n      } else {\n        $(event.target).addClass('was-validated');\n      }\n    });\n\n    $('#swh-show-origin-save-requests-list').on('click', (event) => {\n      event.preventDefault();\n      $('.nav-tabs a[href=\"#swh-origin-save-requests-list\"]').tab('show');\n    });\n\n    $('#swh-input-origin-url').on('input', function(event) {\n      let originUrl = $(this).val().trim();\n      $(this).val(originUrl);\n      $('#swh-input-visit-type option').each(function() {\n        let val = $(this).val();\n        if (val && originUrl.includes(val)) {\n          $(this).prop('selected', true);\n        }\n      });\n    });\n\n    if (window.location.hash === '#requests') {\n      $('.nav-tabs a[href=\"#swh-origin-save-requests-list\"]').tab('show');\n    }\n\n  });\n\n}\n\nexport function validateSaveOriginUrl(input) {\n  let originType = $('#swh-input-visit-type').val();\n  let originUrl = null;\n  let validUrl = true;\n\n  try {\n    originUrl = new URL(input.value.trim());\n  } catch (TypeError) {\n    validUrl = false;\n  }\n\n  if (validUrl) {\n    let allowedProtocols = ['http:', 'https:', 'svn:', 'git:'];\n    validUrl = (\n      allowedProtocols.find(protocol => protocol === originUrl.protocol) !== undefined\n    );\n  }\n\n  if (validUrl && originType === 'git') {\n    // additional checks for well known code hosting providers\n    switch (originUrl.hostname) {\n      case 'github.com':\n        validUrl = isGitRepoUrl(originUrl);\n        break;\n\n      case 'git.code.sf.net':\n        validUrl = isGitRepoUrl(originUrl, '/p/');\n        break;\n\n      case 'bitbucket.org':\n        validUrl = isGitRepoUrl(originUrl);\n        break;\n\n      default:\n        if (originUrl.hostname.startsWith('gitlab.')) {\n          validUrl = isGitRepoUrl(originUrl);\n        }\n        break;\n    }\n  }\n\n  if (validUrl) {\n    input.setCustomValidity('');\n  } else {\n    input.setCustomValidity('The origin url is not valid or does not reference a code repository');\n  }\n}\n\nexport function initTakeNewSnapshot() {\n\n  let newSnapshotRequestAcceptedAlert = htmlAlert(\n    'success',\n    'The \"take new snapshot\" request has been accepted and will be processed as soon as possible.',\n    true\n  );\n\n  let newSnapshotRequestPendingAlert = htmlAlert(\n    'warning',\n    'The \"take new snapshot\" request has been put in pending state and may be accepted for processing after manual review.',\n    true\n  );\n\n  let newSnapshotRequestRateLimitAlert = htmlAlert(\n    'danger',\n    'The rate limit for \"take new snapshot\" requests has been reached. Please try again later.',\n    true\n  );\n\n  let newSnapshotRequestUnknownErrorAlert = htmlAlert(\n    'danger',\n    'An unexpected error happened when submitting the \"save code now request\".',\n    true\n  );\n\n  $(document).ready(() => {\n    $('#swh-take-new-snapshot-form').submit(event => {\n      event.preventDefault();\n      event.stopPropagation();\n\n      let originType = $('#swh-input-visit-type').val();\n      let originUrl = $('#swh-input-origin-url').val();\n      let extraData = {};\n\n      originSaveRequest(originType, originUrl, extraData,\n                        () => $('#swh-take-new-snapshot-request-status').html(newSnapshotRequestAcceptedAlert),\n                        () => $('#swh-take-new-snapshot-request-status').html(newSnapshotRequestPendingAlert),\n                        (statusCode, errorData) => {\n                          $('#swh-take-new-snapshot-request-status').css('color', 'red');\n                          if (statusCode === 403) {\n                            const errorAlert = htmlAlert('danger', `Error: ${errorData['detail']}`, true);\n                            $('#swh-take-new-snapshot-request-status').html(errorAlert);\n                          } else if (statusCode === 429) {\n                            $('#swh-take-new-snapshot-request-status').html(newSnapshotRequestRateLimitAlert);\n                          } else {\n                            $('#swh-take-new-snapshot-request-status').html(newSnapshotRequestUnknownErrorAlert);\n                          }\n                        });\n    });\n  });\n}\n\nexport function formatValuePerType(type, value) {\n  // Given some typed value, format and return accordingly formatted value\n  const mapFormatPerTypeFn = {\n    'json': (v) => JSON.stringify(v, null, 2),\n    'date': (v) => new Date(v).toLocaleString(),\n    'raw': (v) => v,\n    'duration': (v) => v + ' seconds'\n  };\n\n  return value === null ? null : mapFormatPerTypeFn[type](value);\n}\n\nexport function displaySaveRequestInfo(event, saveRequestId) {\n  event.stopPropagation();\n  const saveRequestTaskInfoUrl = Urls.origin_save_task_info(saveRequestId);\n  // close popover when clicking again on the info icon\n  if ($(event.target).data('bs.popover')) {\n    $(event.target).popover('dispose');\n    return;\n  }\n  $('.swh-save-request-info').popover('dispose');\n  $(event.target).popover({\n    animation: false,\n    boundary: 'viewport',\n    container: 'body',\n    title: 'Save request task information ' +\n             '<i style=\"cursor: pointer; position: absolute; right: 1rem;\" ' +\n             `class=\"mdi mdi-close swh-save-request-info-close\"></i>`,\n    content: `<div class=\"swh-popover swh-save-request-info-popover\">\n                  <div class=\"text-center\">\n                    <img src=${swhSpinnerSrc}></img>\n                    <p>Fetching task information ...</p>\n                  </div>\n                </div>`,\n    html: true,\n    placement: 'left',\n    sanitizeFn: swh.webapp.filterXSS\n  });\n\n  $(event.target).on('shown.bs.popover', function() {\n    const popoverId = $(this).attr('aria-describedby');\n    $(`#${popoverId} .mdi-close`).click(() => {\n      $(this).popover('dispose');\n    });\n  });\n\n  $(event.target).popover('show');\n  fetch(saveRequestTaskInfoUrl)\n    .then(response => response.json())\n    .then(saveRequestTaskInfo => {\n      let content;\n      if ($.isEmptyObject(saveRequestTaskInfo)) {\n        content = 'Not available';\n      } else {\n        let saveRequestInfo = [];\n        const taskData = {\n          'Type': ['raw', 'type'],\n          'Visit status': ['raw', 'visit_status'],\n          'Arguments': ['json', 'arguments'],\n          'Id': ['raw', 'id'],\n          'Backend id': ['raw', 'backend_id'],\n          'Scheduling date': ['date', 'scheduled'],\n          'Start date': ['date', 'started'],\n          'Completion date': ['date', 'ended'],\n          'Duration': ['duration', 'duration'],\n          'Runner': ['raw', 'worker'],\n          'Log': ['raw', 'message']\n        };\n        for (const [title, [type, property]] of Object.entries(taskData)) {\n          if (saveRequestTaskInfo.hasOwnProperty(property)) {\n            saveRequestInfo.push({\n              key: title,\n              value: formatValuePerType(type, saveRequestTaskInfo[property])\n            });\n          }\n        }\n        content = '<table class=\"table\"><tbody>';\n        for (let info of saveRequestInfo) {\n          content +=\n            `<tr>\n              <th class=\"swh-metadata-table-row swh-metadata-table-key\">${info.key}</th>\n              <td class=\"swh-metadata-table-row swh-metadata-table-value\">\n                <pre>${info.value}</pre>\n              </td>\n            </tr>`;\n        }\n        content += '</tbody></table>';\n      }\n      $('.swh-popover').html(content);\n      $(event.target).popover('update');\n    });\n}\n\nexport function fillSaveRequestFormAndScroll(visitType, originUrl) {\n  $('#swh-input-origin-url').val(originUrl);\n  let originTypeFound = false;\n  $('#swh-input-visit-type option').each(function() {\n    let val = $(this).val();\n    if (val && originUrl.includes(val)) {\n      $(this).prop('selected', true);\n      originTypeFound = true;\n    }\n  });\n  if (!originTypeFound) {\n    $('#swh-input-visit-type option').each(function() {\n      let val = $(this).val();\n      if (val === visitType) {\n        $(this).prop('selected', true);\n      }\n    });\n  }\n  window.scrollTo(0, 0);\n}\n"],"sourceRoot":""}