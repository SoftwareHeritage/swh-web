!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.auth=t():(e.swh=e.swh||{},e.swh.auth=t())}(window,(function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/static/",n(n.s=250)}({2:function(e,t,n){"use strict";function r(e){if(!e.ok)throw e;return e}function o(e){for(var t=0;t<e.length;++t)if(!e[t].ok)throw e[t];return e}function s(e){return"/static/"+e}function a(e,t,n){return void 0===t&&(t={}),void 0===n&&(n=null),t["X-CSRFToken"]=Cookies.get("csrftoken"),fetch(e,{credentials:"include",headers:t,method:"POST",body:n})}function i(e,t){return new RegExp("(?:git|https?|git@)(?:\\:\\/\\/)?"+t+"[/|:][A-Za-z0-9-/]+?\\/[\\w\\.-]+\\/?(?!=.git)(?:\\.git(?:\\/?|\\#[\\w\\.\\-_]+)?)?$").test(e)}function u(){history.replaceState("",document.title,window.location.pathname+window.location.search)}function d(e,t){var n=window.getSelection();n.removeAllRanges();var r=document.createRange();r.setStart(e,0),"#text"!==t.nodeName?r.setEnd(t,t.childNodes.length):r.setEnd(t,t.textContent.length),n.addRange(r)}function l(e,t,n){void 0===n&&(n=!1);var r="",o="";return n&&(r='<button type="button" class="close" data-dismiss="alert" aria-label="Close">\n        <span aria-hidden="true">&times;</span>\n      </button>',o="alert-dismissible"),'<div class="alert alert-'+e+" "+o+'" role="alert">'+t+r+"</div>"}n.d(t,"b",(function(){return r})),n.d(t,"c",(function(){return o})),n.d(t,"h",(function(){return s})),n.d(t,"a",(function(){return a})),n.d(t,"e",(function(){return i})),n.d(t,"f",(function(){return u})),n.d(t,"g",(function(){return d})),n.d(t,"d",(function(){return l}))},250:function(e,t,n){e.exports=n(251)},251:function(e,t,n){"use strict";n.r(t),n.d(t,"applyTokenAction",(function(){return w})),n.d(t,"initApiTokensPage",(function(){return h}));var r,o=n(2);n(252);function s(){var e=$("#swh-user-password").val();$("#swh-user-password-submit").prop("disabled",0===e.length)}function a(e){return'<p id="swh-token-error-message" class="mt-3">'+e+"</p>"}function i(e){return'<p id="swh-token-success-message" class="mt-3">'+e+"</p>"}function u(){$("#swh-user-password-submit").prop("disabled",!0),$("#swh-user-password").off("change"),$("#swh-user-password").off("keyup")}function d(){Object(o.a)(Urls.oidc_generate_bearer_token(),{},JSON.stringify({password:$("#swh-user-password").val()})).then(o.b).then((function(e){return e.text()})).then((function(e){u();var t=i("Below is your token.")+'\n         <pre id="swh-bearer-token">'+e+"</pre>";$("#swh-password-form").append(t),r.draw()})).catch((function(e){400===e.status?$("#swh-password-form").append(a("You are not allowed to generate bearer tokens.")):401===e.status?$("#swh-password-form").append(a("The password is invalid.")):$("#swh-password-form").append(a("Internal server error."))}))}function l(e){var t={password:$("#swh-user-password").val(),token_id:e};Object(o.a)(Urls.oidc_get_bearer_token(),{},JSON.stringify(t)).then(o.b).then((function(e){return e.text()})).then((function(e){u();var t=i("Below is your token.")+'\n         <pre id="swh-bearer-token">'+e+"</pre>";$("#swh-password-form").append(t)})).catch((function(e){401===e.status?$("#swh-password-form").append(a("The password is invalid.")):$("#swh-password-form").append(a("Internal server error."))}))}function c(e){var t={password:$("#swh-user-password").val(),token_ids:e};Object(o.a)(Urls.oidc_revoke_bearer_tokens(),{},JSON.stringify(t)).then(o.b).then((function(){u(),$("#swh-password-form").append(i("Bearer token"+(e.length>1?"s":"")+" successfully revoked")),r.draw()})).catch((function(e){401===e.status?$("#swh-password-form").append(a("The password is invalid.")):$("#swh-password-form").append(a("Internal server error."))}))}function p(e){c([e])}function f(){for(var e=[],t=r.rows().data(),n=0;n<t.length;++n)e.push(t[n].id);c(e)}function w(e,t){var n={generate:{modalTitle:"Bearer token generation",infoText:"Enter your password and click on the button to generate the token.",buttonText:"Generate token",submitCallback:d},display:{modalTitle:"Display bearer token",infoText:"Enter your password and click on the button to display the token.",buttonText:"Display token",submitCallback:l},revoke:{modalTitle:"Revoke bearer token",infoText:"Enter your password and click on the button to revoke the token.",buttonText:"Revoke token",submitCallback:p},revokeAll:{modalTitle:"Revoke all bearer tokens",infoText:"Enter your password and click on the button to revoke all tokens.",buttonText:"Revoke tokens",submitCallback:f}};if(n[e]){var r,o,a=(r=n[e].infoText,o=n[e].buttonText,'<form id="swh-password-form">\n      <p id="swh-password-form-text">'+r+'</p>\n      <label for="swh-user-password">Password:&nbsp;</label>\n      <input id="swh-user-password" type="password" name="swh-user-password" required>\n      <input id="swh-user-password-submit" type="submit" value="'+o+'" disabled>\n    </form>');swh.webapp.showModalHtml(n[e].modalTitle,a),$("#swh-user-password").change(s),$("#swh-user-password").keyup(s),$("#swh-password-form").submit((function(r){r.preventDefault(),r.stopPropagation(),n[e].submitCallback(t)}))}}function h(){$(document).ready((function(){r=$("#swh-bearer-tokens-table").on("error.dt",(function(e,t,n,r){$("#swh-origin-save-request-list-error").text("An error occurred while retrieving the tokens list"),console.log(r)})).DataTable({serverSide:!0,ajax:Urls.oidc_list_bearer_tokens(),columns:[{data:"creation_date",name:"creation_date",render:function(e,t,n){return"display"===t?new Date(e).toLocaleString():e}},{render:function(e,t,n){return'<button class="btn btn-default"\n                         onclick="swh.auth.applyTokenAction(\'display\', '+n.id+')">\n                  Display token\n                </button>\n                <button class="btn btn-default"\n                        onclick="swh.auth.applyTokenAction(\'revoke\', '+n.id+')">\n                  Revoke token\n                </button>'}}],ordering:!1,searching:!1,scrollY:"50vh",scrollCollapse:!0})}))}},252:function(e,t,n){}})}));
//# sourceMappingURL=auth.7b9039b237ee77875d0c.js.map