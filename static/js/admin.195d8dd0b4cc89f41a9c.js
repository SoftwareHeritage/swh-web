!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.admin=t():(e.swh=e.swh||{},e.swh.admin=t())}(window,(function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var a=t[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,n),a.l=!0,a.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(r,a,function(t){return e[t]}.bind(null,a));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/static/",n(n.s=237)}({155:function(e,t,n){"use strict";function r(e,t){if("display"===t&&(e&&e.startsWith("swh")))return'<a href="'+Urls.browse_swh_id(e)+'">'+e+"</a>";return e}function a(){var e;$(document).ready((function(){$.fn.dataTable.ext.errMode="none",(e=$("#swh-admin-deposit-list").on("error.dt",(function(e,t,n,r){$("#swh-admin-deposit-list-error").text(r)})).DataTable({serverSide:!0,ajax:Urls.admin_deposit_list(),columns:[{data:"id",name:"id"},{data:"swh_id_context",name:"swh_id_context",render:function(e,t,n){if(e&&"display"===t){var r=e.indexOf(";origin=");if(-1!==r){var a=e.slice(r+";origin=".length);return'<a href="'+a+'">'+a+"</a>"}}return e}},{data:"reception_date",name:"reception_date",render:function(e,t,n){return"display"===t?new Date(e).toLocaleString():e}},{data:"status",name:"status"},{data:"status_detail",name:"status_detail",render:function(e,t,n){if("display"===t&&e){var r=e;return"object"==typeof e&&(r=JSON.stringify(e,null,4)),'<div style="width: 200px; white-space: pre; overflow-x: auto;">'+r+"</div>"}return e},orderable:!1,visible:!1},{data:"swh_anchor_id",name:"swh_anchor_id",render:function(e,t,n){return r(e,t)},orderable:!1},{data:"swh_anchor_id_context",name:"swh_anchor_id_context",render:function(e,t,n){return r(e,t)},orderable:!1,visible:!1},{data:"swh_id",name:"swh_id",render:function(e,t,n){return r(e,t)},orderable:!1,visible:!1},{data:"swh_id_context",name:"swh_id_context",render:function(e,t,n){return r(e,t)},orderable:!1,visible:!1}],scrollX:!0,scrollY:"50vh",scrollCollapse:!0,order:[[0,"desc"]]})).draw()})),$("a.toggle-col").on("click",(function(t){t.preventDefault();var n=e.column($(this).attr("data-column"));n.visible(!n.visible()),n.visible()?$(this).removeClass("col-hidden"):$(this).addClass("col-hidden")}))}n.d(t,"a",(function(){return a}))},156:function(e,t,n){"use strict";n.d(t,"e",(function(){return l})),n.d(t,"b",(function(){return h})),n.d(t,"h",(function(){return f})),n.d(t,"c",(function(){return v})),n.d(t,"k",(function(){return p})),n.d(t,"a",(function(){return g})),n.d(t,"f",(function(){return w})),n.d(t,"i",(function(){return m})),n.d(t,"g",(function(){return _})),n.d(t,"j",(function(){return y})),n.d(t,"d",(function(){return j}));var r,a,i,s,o,u=n(2),d=n(21);function c(e){$(e+" tbody").on("click","tr",(function(){$(this).hasClass("selected")?($(this).removeClass("selected"),$(e).closest(".tab-pane").find(".swh-action-need-selection").prop("disabled",!0)):($(e+" tr.selected").removeClass("selected"),$(this).addClass("selected"),$(e).closest(".tab-pane").find(".swh-action-need-selection").prop("disabled",!1))}))}function l(){$(document).ready((function(){$.fn.dataTable.ext.errMode="throw",r=$("#swh-authorized-origin-urls").DataTable({serverSide:!0,ajax:Urls.admin_origin_save_authorized_urls_list(),columns:[{data:"url",name:"url"}],scrollY:"50vh",scrollCollapse:!0,info:!1}),c("#swh-authorized-origin-urls"),swh.webapp.addJumpToPagePopoverToDataTable(r),a=$("#swh-unauthorized-origin-urls").DataTable({serverSide:!0,ajax:Urls.admin_origin_save_unauthorized_urls_list(),columns:[{data:"url",name:"url"}],scrollY:"50vh",scrollCollapse:!0,info:!1}),c("#swh-unauthorized-origin-urls"),swh.webapp.addJumpToPagePopoverToDataTable(a);var e=[{data:"id",name:"id",visible:!1,searchable:!1},{data:"save_request_date",name:"request_date",render:function(e,t,n){return"display"===t?new Date(e).toLocaleString():e}},{data:"visit_type",name:"visit_type"},{data:"origin_url",name:"origin_url",render:function(e,t,n){if("display"===t){var r=$.fn.dataTable.render.text().display(e);return'<a href="'+r+'">'+r+"</a>"}return e}}];i=$("#swh-origin-save-pending-requests").DataTable({serverSide:!0,processing:!0,language:{processing:'<img src="'+d.c+'"></img>'},ajax:Urls.origin_save_requests_list("pending"),searchDelay:1e3,columns:e,scrollY:"50vh",scrollCollapse:!0,order:[[0,"desc"]],responsive:{details:{type:"none"}}}),c("#swh-origin-save-pending-requests"),swh.webapp.addJumpToPagePopoverToDataTable(i),o=$("#swh-origin-save-rejected-requests").DataTable({serverSide:!0,processing:!0,language:{processing:'<img src="'+d.c+'"></img>'},ajax:Urls.origin_save_requests_list("rejected"),searchDelay:1e3,columns:e,scrollY:"50vh",scrollCollapse:!0,order:[[0,"desc"]],responsive:{details:{type:"none"}}}),c("#swh-origin-save-rejected-requests"),swh.webapp.addJumpToPagePopoverToDataTable(o),e.push({data:"save_task_status",name:"save_task_status",render:function(e,t,n){if("succeed"===e&&n.visit_date){var r=Urls.browse_origin(n.origin_url);return'<a href="'+(r+="visit/"+n.visit_date+"/")+'">'+e+"</a>"}return e}}),e.push({name:"info",render:function(e,t,n){return"succeed"===n.save_task_status||"failed"===n.save_task_status?'<i class="fa fa-info-circle swh-save-request-info" aria-hidden="true" style="cursor: pointer"onclick="swh.admin.displaySaveRequestInfo(event, '+n.id+')"></i>':""}}),s=$("#swh-origin-save-accepted-requests").DataTable({serverSide:!0,processing:!0,language:{processing:'<img src="'+d.c+'"></img>'},ajax:Urls.origin_save_requests_list("accepted"),searchDelay:1e3,columns:e,scrollY:"50vh",scrollCollapse:!0,order:[[0,"desc"]],responsive:{details:{type:"none"}}}),c("#swh-origin-save-accepted-requests"),swh.webapp.addJumpToPagePopoverToDataTable(s),$("#swh-origin-save-requests-nav-item").on("shown.bs.tab",(function(){i.draw()})),$("#swh-origin-save-url-filters-nav-item").on("shown.bs.tab",(function(){r.draw()})),$("#swh-authorized-origins-tab").on("shown.bs.tab",(function(){r.draw()})),$("#swh-unauthorized-origins-tab").on("shown.bs.tab",(function(){a.draw()})),$("#swh-save-requests-pending-tab").on("shown.bs.tab",(function(){i.draw()})),$("#swh-save-requests-accepted-tab").on("shown.bs.tab",(function(){s.draw()})),$("#swh-save-requests-rejected-tab").on("shown.bs.tab",(function(){o.draw()})),$("#swh-save-requests-pending-tab").click((function(){i.ajax.reload(null,!1)})),$("#swh-save-requests-accepted-tab").click((function(){s.ajax.reload(null,!1)})),$("#swh-save-requests-rejected-tab").click((function(){o.ajax.reload(null,!1)})),$("body").on("click",(function(e){$(e.target).parents(".popover").length>0?event.stopPropagation():0===$(e.target).parents(".swh-save-request-info").length&&$(".swh-save-request-info").popover("dispose")}))}))}function h(){var e=$("#swh-authorized-url-prefix").val(),t=Urls.admin_origin_save_add_authorized_url(e);Object(u.a)(t).then(u.b).then((function(){r.row.add({url:e}).draw(),$(".swh-add-authorized-origin-status").html(Object(u.d)("success","The origin url prefix has been successfully added in the authorized list.",!0))})).catch((function(e){$(".swh-add-authorized-origin-status").html(Object(u.d)("warning","The provided origin url prefix is already registered in the authorized list.",!0))}))}function f(){var e=$("#swh-authorized-origin-urls tr.selected").text();if(e){var t=Urls.admin_origin_save_remove_authorized_url(e);Object(u.a)(t).then(u.b).then((function(){r.row(".selected").remove().draw()})).catch((function(){}))}}function v(){var e=$("#swh-unauthorized-url-prefix").val(),t=Urls.admin_origin_save_add_unauthorized_url(e);Object(u.a)(t).then(u.b).then((function(){a.row.add({url:e}).draw(),$(".swh-add-unauthorized-origin-status").html(Object(u.d)("success","The origin url prefix has been successfully added in the unauthorized list.",!0))})).catch((function(){$(".swh-add-unauthorized-origin-status").html(Object(u.d)("warning","The provided origin url prefix is already registered in the unauthorized list.",!0))}))}function p(){var e=$("#swh-unauthorized-origin-urls tr.selected").text();if(e){var t=Urls.admin_origin_save_remove_unauthorized_url(e);Object(u.a)(t).then(u.b).then((function(){a.row(".selected").remove().draw()})).catch((function(){}))}}function g(){var e=i.row(".selected");if(e.length){swh.webapp.showModalConfirm("Accept origin save request ?","Are you sure to accept this origin save request ?",(function(){var t=e.data(),n=Urls.admin_origin_save_request_accept(t.visit_type,t.origin_url);Object(u.a)(n).then((function(){i.ajax.reload(null,!1)}))}))}}function w(){var e=i.row(".selected");if(e.length){swh.webapp.showModalConfirm("Reject origin save request ?","Are you sure to reject this origin save request ?",(function(){var t=e.data(),n=Urls.admin_origin_save_request_reject(t.visit_type,t.origin_url);Object(u.a)(n).then((function(){i.ajax.reload(null,!1)}))}))}}function b(e){var t=e.row(".selected");if(t.length){var n=t.data().id;swh.webapp.showModalConfirm("Remove origin save request ?","Are you sure to remove this origin save request ?",(function(){var t=Urls.admin_origin_save_request_remove(n);Object(u.a)(t).then((function(){e.ajax.reload(null,!1)}))}))}}function m(){b(i)}function _(){b(s)}function y(){b(o)}function j(e,t){e.stopPropagation();var n=Urls.admin_origin_save_task_info(t);$(".swh-save-request-info").popover("dispose"),$(e.target).popover({title:"Save request task information",content:'<div class="swh-popover">\n                  <div class="text-center">\n                    <img src='+d.c+"></img>\n                    <p>Fetching task information ...</p>\n                  </div>\n                </div>",html:!0,placement:"left",sanitizeFn:swh.webapp.filterXSS}),$(e.target).popover("show"),fetch(n).then((function(e){return e.json()})).then((function(t){var n;if($.isEmptyObject(t))n="Not available";else{var r=[];r.push({key:"Task type",value:t.type}),t.hasOwnProperty("task_name")&&r.push({key:"Task name",value:t.name}),r.push({key:"Task arguments",value:JSON.stringify(t.arguments,null,2)}),r.push({key:"Task id",value:t.id}),r.push({key:"Task backend id",value:t.backend_id}),r.push({key:"Task scheduling date",value:new Date(t.scheduled).toLocaleString()}),r.push({key:"Task termination date",value:new Date(t.ended).toLocaleString()}),t.hasOwnProperty("duration")&&r.push({key:"Task duration",value:t.duration+" s"}),t.hasOwnProperty("worker")&&r.push({key:"Task executor",value:t.worker}),t.hasOwnProperty("message")&&r.push({key:"Task log",value:t.message}),n='<table class="table"><tbody>';for(var a=0,i=r;a<i.length;a++){var s=i[a];n+='<tr>\n              <th class="swh-metadata-table-row swh-metadata-table-key">'+s.key+'</th>\n              <td class="swh-metadata-table-row swh-metadata-table-value">\n                <pre>'+s.value+"</pre>\n              </td>\n            </tr>"}n+="</tbody></table>"}$(".swh-popover").html(n),$(e.target).popover("update")}))}},2:function(e,t,n){"use strict";function r(e){if(!e.ok)throw e;return e}function a(e){for(var t=0;t<e.length;++t)if(!e[t].ok)throw e[t];return e}function i(e){return"/static/"+e}function s(e,t,n){return void 0===t&&(t={}),void 0===n&&(n=null),t["X-CSRFToken"]=Cookies.get("csrftoken"),fetch(e,{credentials:"include",headers:t,method:"POST",body:n})}function o(e,t){return new RegExp("(?:git|https?|git@)(?:\\:\\/\\/)?"+t+"[/|:][A-Za-z0-9-/]+?\\/[\\w\\.-]+\\/?(?!=.git)(?:\\.git(?:\\/?|\\#[\\w\\.\\-_]+)?)?$").test(e)}function u(){history.replaceState("",document.title,window.location.pathname+window.location.search)}function d(e,t){var n=window.getSelection();n.removeAllRanges();var r=document.createRange();r.setStart(e,0),"#text"!==t.nodeName?r.setEnd(t,t.childNodes.length):r.setEnd(t,t.textContent.length),n.addRange(r)}function c(e,t,n){void 0===n&&(n=!1);var r="",a="";return n&&(r='<button type="button" class="close" data-dismiss="alert" aria-label="Close">\n        <span aria-hidden="true">&times;</span>\n      </button>',a="alert-dismissible"),'<div class="alert alert-'+e+" "+a+'" role="alert">'+t+r+"</div>"}n.d(t,"b",(function(){return r})),n.d(t,"c",(function(){return a})),n.d(t,"h",(function(){return i})),n.d(t,"a",(function(){return s})),n.d(t,"e",(function(){return o})),n.d(t,"f",(function(){return u})),n.d(t,"g",(function(){return d})),n.d(t,"d",(function(){return c}))},21:function(e,t,n){"use strict";n.d(t,"b",(function(){return a})),n.d(t,"a",(function(){return i})),n.d(t,"c",(function(){return s}));var r=n(2),a=768,i=992,s=Object(r.h)("img/swh-spinner.gif")},237:function(e,t,n){e.exports=n(238)},238:function(e,t,n){"use strict";n.r(t);var r=n(155);n.d(t,"initDepositAdmin",(function(){return r.a}));var a=n(156);n.d(t,"initOriginSaveAdmin",(function(){return a.e})),n.d(t,"addAuthorizedOriginUrl",(function(){return a.b})),n.d(t,"removeAuthorizedOriginUrl",(function(){return a.h})),n.d(t,"addUnauthorizedOriginUrl",(function(){return a.c})),n.d(t,"removeUnauthorizedOriginUrl",(function(){return a.k})),n.d(t,"acceptOriginSaveRequest",(function(){return a.a})),n.d(t,"rejectOriginSaveRequest",(function(){return a.f})),n.d(t,"removePendingOriginSaveRequest",(function(){return a.i})),n.d(t,"removeAcceptedOriginSaveRequest",(function(){return a.g})),n.d(t,"removeRejectedOriginSaveRequest",(function(){return a.j})),n.d(t,"displaySaveRequestInfo",(function(){return a.d}))}})}));
//# sourceMappingURL=admin.195d8dd0b4cc89f41a9c.js.map