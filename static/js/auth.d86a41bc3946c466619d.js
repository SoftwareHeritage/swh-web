!function(e,o){"object"==typeof exports&&"object"==typeof module?module.exports=o():"function"==typeof define&&define.amd?define([],o):"object"==typeof exports?exports.swh=o():(e.swh=e.swh||{},e.swh.auth=o())}(self,(function(){return function(){"use strict";var e={37515:function(e,o,t){t.r(o),t.d(o,{applyTokenAction:function(){return f},initProfilePage:function(){return h}});var n,r=t(45149);function s(){var e=$("#swh-user-password").val();$("#swh-user-password-submit").prop("disabled",0===e.length)}function a(e){return'<p id="swh-token-error-message" class="mt-3">'+e+"</p>"}function i(e){return'<p id="swh-token-success-message" class="mt-3">'+e+"</p>"}function u(){$("#swh-user-password-submit").prop("disabled",!0),$("#swh-user-password").off("change"),$("#swh-user-password").off("keyup")}function d(){(0,r.e_)(Urls.oidc_generate_bearer_token(),{},JSON.stringify({password:$("#swh-user-password").val()})).then(r.ry).then((function(e){return e.text()})).then((function(e){u();var o=i("Below is your token.")+'\n         <pre id="swh-bearer-token">'+e+"</pre>";$("#swh-password-form").append(o),n.draw()})).catch((function(e){400===e.status?$("#swh-password-form").append(a("You are not allowed to generate bearer tokens.")):401===e.status?$("#swh-password-form").append(a("The password is invalid.")):$("#swh-password-form").append(a("Internal server error."))}))}function l(e){var o={password:$("#swh-user-password").val(),token_id:e};(0,r.e_)(Urls.oidc_get_bearer_token(),{},JSON.stringify(o)).then(r.ry).then((function(e){return e.text()})).then((function(e){u();var o=i("Below is your token.")+'\n         <pre id="swh-bearer-token">'+e+"</pre>";$("#swh-password-form").append(o)})).catch((function(e){401===e.status?$("#swh-password-form").append(a("The password is invalid.")):$("#swh-password-form").append(a("Internal server error."))}))}function p(e){var o={password:$("#swh-user-password").val(),token_ids:e};(0,r.e_)(Urls.oidc_revoke_bearer_tokens(),{},JSON.stringify(o)).then(r.ry).then((function(){u(),$("#swh-password-form").append(i("Bearer token"+(e.length>1?"s":"")+" successfully revoked")),n.draw()})).catch((function(e){401===e.status?$("#swh-password-form").append(a("The password is invalid.")):$("#swh-password-form").append(a("Internal server error."))}))}function c(e){p([e])}function w(){for(var e=[],o=n.rows().data(),t=0;t<o.length;++t)e.push(o[t].id);p(e)}function f(e,o){var t={generate:{modalTitle:"Bearer token generation",infoText:"Enter your password and click on the button to generate the token.",buttonText:"Generate token",submitCallback:d},display:{modalTitle:"Display bearer token",infoText:"Enter your password and click on the button to display the token.",buttonText:"Display token",submitCallback:l},revoke:{modalTitle:"Revoke bearer token",infoText:"Enter your password and click on the button to revoke the token.",buttonText:"Revoke token",submitCallback:c},revokeAll:{modalTitle:"Revoke all bearer tokens",infoText:"Enter your password and click on the button to revoke all tokens.",buttonText:"Revoke tokens",submitCallback:w}};if(t[e]){var n,r,a=(n=t[e].infoText,r=t[e].buttonText,'<form id="swh-password-form">\n      <p id="swh-password-form-text">'+n+'</p>\n      <label for="swh-user-password">Password:&nbsp;</label>\n      <input id="swh-user-password" type="password" name="swh-user-password" required>\n      <input id="swh-user-password-submit" type="submit" value="'+r+'" disabled>\n    </form>');swh.webapp.showModalHtml(t[e].modalTitle,a),$("#swh-user-password").change(s),$("#swh-user-password").keyup(s),$("#swh-password-form").submit((function(n){n.preventDefault(),n.stopPropagation(),t[e].submitCallback(o)}))}}function h(){$(document).ready((function(){n=$("#swh-bearer-tokens-table").on("error.dt",(function(e,o,t,n){$("#swh-origin-save-request-list-error").text("An error occurred while retrieving the tokens list"),console.log(n)})).DataTable({serverSide:!0,ajax:Urls.oidc_list_bearer_tokens(),columns:[{data:"creation_date",name:"creation_date",render:function(e,o,t){return"display"===o?new Date(e).toLocaleString():e}},{render:function(e,o,t){return'<button class="btn btn-default"\n                         onclick="swh.auth.applyTokenAction(\'display\', '+t.id+')">\n                  Display token\n                </button>\n                <button class="btn btn-default"\n                        onclick="swh.auth.applyTokenAction(\'revoke\', '+t.id+')">\n                  Revoke token\n                </button>'}}],ordering:!1,searching:!1,scrollY:"50vh",scrollCollapse:!0}),$("#swh-oidc-profile-tokens-tab").on("shown.bs.tab",(function(){n.draw(),window.location.hash="#tokens"})),$("#swh-oidc-profile-account-tab").on("shown.bs.tab",(function(){(0,r.L3)()})),"#tokens"===window.location.hash&&$('.nav-tabs a[href="#swh-oidc-profile-tokens"]').tab("show")}))}},45149:function(e,o,t){function n(e){if(!e.ok)throw e;return e}function r(e,o,t){return void 0===o&&(o={}),void 0===t&&(t=null),o["X-CSRFToken"]=Cookies.get("csrftoken"),fetch(e,{credentials:"include",headers:o,method:"POST",body:t})}function s(){history.replaceState("",document.title,window.location.pathname+window.location.search)}t.d(o,{ry:function(){return n},e_:function(){return r},L3:function(){return s}})}},o={};function t(n){if(o[n])return o[n].exports;var r=o[n]={exports:{}};return e[n](r,r.exports,t),r.exports}return t.d=function(e,o){for(var n in o)t.o(o,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:o[n]})},t.o=function(e,o){return Object.prototype.hasOwnProperty.call(e,o)},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t(37515)}()}));
//# sourceMappingURL=auth.d86a41bc3946c466619d.js.map