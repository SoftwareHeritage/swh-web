{"version":3,"sources":["webpack://swh.save/webpack/universalModuleDefinition","webpack://swh.save/./assets/src/utils/constants.js","webpack://swh.save/./assets/src/utils/functions.js","webpack://swh.save/webpack/bootstrap","webpack://swh.save/webpack/runtime/define property getters","webpack://swh.save/webpack/runtime/hasOwnProperty shorthand","webpack://swh.save/webpack/runtime/make namespace object","webpack://swh.save/./assets/src/bundles/save/index.js"],"names":["root","factory","exports","module","define","amd","self","swhSpinnerSrc","staticAsset","handleFetchError","response","ok","asset","__STATIC__","isGitRepoUrl","url","pathPrefix","undefined","find","protocol","pathname","startsWith","RegExp","test","slice","length","removeUrlFragment","history","replaceState","document","title","window","location","search","htmlAlert","type","message","closable","closeButton","extraClasses","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","__webpack_modules__","d","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","r","Symbol","toStringTag","value","saveRequestsTable","originSaveRequest","originType","originUrl","acceptedCallback","pendingCallback","errorCallback","addSaveOriginRequestUrl","Urls","api_1_save_origin","$","css","fetch","method","then","json","data","save_request_status","errorData","status","initOriginSave","ready","fn","dataTable","ext","errMode","origin_save_types_list","append","on","e","settings","techNote","text","console","log","DataTable","serverSide","processing","language","ajax","origin_save_requests_list","searchDelay","columns","name","render","row","Date","toLocaleString","html","sanitizedURL","display","save_task_status","browseOriginUrl","browse_origin","encodeURIComponent","visit_date","id","visit_type","origin_url","scrollY","scrollCollapse","order","responsive","details","swh","webapp","addJumpToPagePopoverToDataTable","draw","hash","popover","saveRequestAcceptedAlert","saveRequestPendingAlert","saveRequestRateLimitedAlert","saveRequestUnknownErrorAlert","submit","event","preventDefault","stopPropagation","alert","target","checkValidity","removeClass","val","statusCode","errorAlert","addClass","tab","this","trim","each","includes","validateSaveOriginUrl","input","validUrl","URL","TypeError","hostname","setCustomValidity","initTakeNewSnapshot","newSnapshotRequestAcceptedAlert","newSnapshotRequestPendingAlert","newSnapshotRequestRateLimitAlert","newSnapshotRequestUnknownErrorAlert","formatValuePerType","v","JSON","stringify","displaySaveRequestInfo","saveRequestId","saveRequestTaskInfoUrl","origin_save_task_info","animation","boundary","container","content","placement","sanitizeFn","filterXSS","popoverId","attr","click","saveRequestTaskInfo","isEmptyObject","saveRequestInfo","entries","property","push","info","fillSaveRequestFormAndScroll","visitType","originTypeFound","scrollTo"],"mappings":"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","file":"js/save.2db2ad5d1acc2e02c62c.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"swh\"] = factory();\n\telse\n\t\troot[\"swh\"] = root[\"swh\"] || {}, root[\"swh\"][\"save\"] = factory();\n})(self, function() {\nreturn ","/**\n * Copyright (C) 2019  The Software Heritage developers\n * See the AUTHORS file at the top-level directory of this distribution\n * License: GNU Affero General Public License version 3, or any later version\n * See top-level LICENSE file for more information\n */\n\nimport {staticAsset} from 'utils/functions';\n\n// Constants defining Bootstrap Breakpoints\nexport const BREAKPOINT_SM = 768;\nexport const BREAKPOINT_MD = 992;\nexport const BREAKPOINT_LG = 1200;\n\nexport const swhSpinnerSrc = staticAsset('img/swh-spinner.gif');\n","/**\n * Copyright (C) 2018-2020  The Software Heritage developers\n * See the AUTHORS file at the top-level directory of this distribution\n * License: GNU Affero General Public License version 3, or any later version\n * See top-level LICENSE file for more information\n */\n\n// utility functions\n\nexport function handleFetchError(response) {\n  if (!response.ok) {\n    throw response;\n  }\n  return response;\n}\n\nexport function handleFetchErrors(responses) {\n  for (let i = 0; i < responses.length; ++i) {\n    if (!responses[i].ok) {\n      throw responses[i];\n    }\n  }\n  return responses;\n}\n\nexport function staticAsset(asset) {\n  return `${__STATIC__}${asset}`;\n}\n\nexport function csrfPost(url, headers = {}, body = null) {\n  headers['X-CSRFToken'] = Cookies.get('csrftoken');\n  return fetch(url, {\n    credentials: 'include',\n    headers: headers,\n    method: 'POST',\n    body: body\n  });\n}\n\nexport function isGitRepoUrl(url, pathPrefix = '/') {\n  let allowedProtocols = ['http:', 'https:', 'git:'];\n  if (allowedProtocols.find(protocol => protocol === url.protocol) === undefined) {\n    return false;\n  }\n  if (!url.pathname.startsWith(pathPrefix)) {\n    return false;\n  }\n  let re = new RegExp('[\\\\w\\\\.-]+\\\\/?(?!=.git)(?:\\\\.git\\\\/?)?$');\n  return re.test(url.pathname.slice(pathPrefix.length));\n};\n\nexport function removeUrlFragment() {\n  history.replaceState('', document.title, window.location.pathname + window.location.search);\n}\n\nexport function selectText(startNode, endNode) {\n  let selection = window.getSelection();\n  selection.removeAllRanges();\n  let range = document.createRange();\n  range.setStart(startNode, 0);\n  if (endNode.nodeName !== '#text') {\n    range.setEnd(endNode, endNode.childNodes.length);\n  } else {\n    range.setEnd(endNode, endNode.textContent.length);\n  }\n  selection.addRange(range);\n}\n\nexport function htmlAlert(type, message, closable = false) {\n  let closeButton = '';\n  let extraClasses = '';\n  if (closable) {\n    closeButton =\n      `<button type=\"button\" class=\"close\" data-dismiss=\"alert\" aria-label=\"Close\">\n        <span aria-hidden=\"true\">&times;</span>\n      </button>`;\n    extraClasses = 'alert-dismissible';\n  }\n  return `<div class=\"alert alert-${type} ${extraClasses}\" role=\"alert\">${message}${closeButton}</div>`;\n}\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define getter functions for harmony exports\n__webpack_require__.d = function(exports, definition) {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = function(obj, prop) { return Object.prototype.hasOwnProperty.call(obj, prop); }","// define __esModule on exports\n__webpack_require__.r = function(exports) {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","/**\n * Copyright (C) 2018-2021  The Software Heritage developers\n * See the AUTHORS file at the top-level directory of this distribution\n * License: GNU Affero General Public License version 3, or any later version\n * See top-level LICENSE file for more information\n */\n\nimport {handleFetchError, isGitRepoUrl, htmlAlert, removeUrlFragment} from 'utils/functions';\nimport {swhSpinnerSrc} from 'utils/constants';\n\nlet saveRequestsTable;\n\nfunction originSaveRequest(originType, originUrl,\n                           acceptedCallback, pendingCallback, errorCallback) {\n  let addSaveOriginRequestUrl = Urls.api_1_save_origin(originType, originUrl);\n  $('.swh-processing-save-request').css('display', 'block');\n  fetch(addSaveOriginRequestUrl, {method: 'POST'})\n    .then(handleFetchError)\n    .then(response => response.json())\n    .then(data => {\n      $('.swh-processing-save-request').css('display', 'none');\n      if (data.save_request_status === 'accepted') {\n        acceptedCallback();\n      } else {\n        pendingCallback();\n      }\n    })\n    .catch(response => {\n      $('.swh-processing-save-request').css('display', 'none');\n      response.json().then(errorData => {\n        errorCallback(response.status, errorData);\n      });\n    });\n}\n\nexport function initOriginSave() {\n\n  $(document).ready(() => {\n\n    $.fn.dataTable.ext.errMode = 'none';\n\n    fetch(Urls.origin_save_types_list())\n      .then(response => response.json())\n      .then(data => {\n        for (let originType of data) {\n          $('#swh-input-visit-type').append(`<option value=\"${originType}\">${originType}</option>`);\n        }\n      });\n\n    saveRequestsTable = $('#swh-origin-save-requests')\n      .on('error.dt', (e, settings, techNote, message) => {\n        $('#swh-origin-save-request-list-error').text('An error occurred while retrieving the save requests list');\n        console.log(message);\n      })\n      .DataTable({\n        serverSide: true,\n        processing: true,\n        language: {\n          processing: `<img src=\"${swhSpinnerSrc}\"></img>`\n        },\n        ajax: Urls.origin_save_requests_list('all'),\n        searchDelay: 1000,\n        columns: [\n          {\n            data: 'save_request_date',\n            name: 'request_date',\n            render: (data, type, row) => {\n              if (type === 'display') {\n                let date = new Date(data);\n                return date.toLocaleString();\n              }\n              return data;\n            }\n          },\n          {\n            data: 'visit_type',\n            name: 'visit_type'\n          },\n          {\n            data: 'origin_url',\n            name: 'origin_url',\n            render: (data, type, row) => {\n              if (type === 'display') {\n                let html = '';\n                const sanitizedURL = $.fn.dataTable.render.text().display(data);\n                if (row.save_task_status === 'succeeded') {\n                  let browseOriginUrl = `${Urls.browse_origin()}?origin_url=${encodeURIComponent(sanitizedURL)}`;\n                  if (row.visit_date) {\n                    browseOriginUrl += `&amp;timestamp=${encodeURIComponent(row.visit_date)}`;\n                  }\n                  html += `<a href=\"${browseOriginUrl}\">${sanitizedURL}</a>`;\n                } else {\n                  html += sanitizedURL;\n                }\n                html += `&nbsp;<a href=\"${sanitizedURL}\"><i class=\"mdi mdi-open-in-new\" aria-hidden=\"true\"></i></a>`;\n                return html;\n              }\n              return data;\n            }\n          },\n          {\n            data: 'save_request_status',\n            name: 'status'\n          },\n          {\n            data: 'save_task_status',\n            name: 'loading_task_status'\n          },\n          {\n            name: 'info',\n            render: (data, type, row) => {\n              if (row.save_task_status === 'succeeded' || row.save_task_status === 'failed') {\n                return `<i class=\"mdi mdi-information-outline swh-save-request-info\" ` +\n                       'aria-hidden=\"true\" style=\"cursor: pointer\"' +\n                       `onclick=\"swh.save.displaySaveRequestInfo(event, ${row.id})\"></i>`;\n              } else {\n                return '';\n              }\n            }\n          },\n          {\n            render: (data, type, row) => {\n              if (row.save_request_status === 'accepted') {\n                const saveAgainButton =\n                  '<button class=\"btn btn-default btn-sm swh-save-origin-again\" type=\"button\" ' +\n                  `onclick=\"swh.save.fillSaveRequestFormAndScroll(` +\n                  `'${row.visit_type}', '${row.origin_url}');\">` +\n                  '<i class=\"mdi mdi-camera mdi-fw\" aria-hidden=\"true\"></i>' +\n                  'Save again</button>';\n                return saveAgainButton;\n              } else {\n                return '';\n              }\n            }\n          }\n        ],\n        scrollY: '50vh',\n        scrollCollapse: true,\n        order: [[0, 'desc']],\n        responsive: {\n          details: {\n            type: 'none'\n          }\n        }\n      });\n\n    swh.webapp.addJumpToPagePopoverToDataTable(saveRequestsTable);\n\n    $('#swh-origin-save-requests-list-tab').on('shown.bs.tab', () => {\n      saveRequestsTable.draw();\n      window.location.hash = '#requests';\n    });\n\n    $('#swh-origin-save-request-help-tab').on('shown.bs.tab', () => {\n      removeUrlFragment();\n      $('.swh-save-request-info').popover('dispose');\n    });\n\n    let saveRequestAcceptedAlert = htmlAlert(\n      'success',\n      'The \"save code now\" request has been accepted and will be processed as soon as possible.',\n      true\n    );\n\n    let saveRequestPendingAlert = htmlAlert(\n      'warning',\n      'The \"save code now\" request has been put in pending state and may be accepted for processing after manual review.',\n      true\n    );\n\n    let saveRequestRateLimitedAlert = htmlAlert(\n      'danger',\n      'The rate limit for \"save code now\" requests has been reached. Please try again later.',\n      true\n    );\n\n    let saveRequestUnknownErrorAlert = htmlAlert(\n      'danger',\n      'An unexpected error happened when submitting the \"save code now request\".',\n      true\n    );\n\n    $('#swh-save-origin-form').submit(event => {\n      event.preventDefault();\n      event.stopPropagation();\n      $('.alert').alert('close');\n      if (event.target.checkValidity()) {\n        $(event.target).removeClass('was-validated');\n        let originType = $('#swh-input-visit-type').val();\n        let originUrl = $('#swh-input-origin-url').val();\n\n        originSaveRequest(originType, originUrl,\n                          () => $('#swh-origin-save-request-status').html(saveRequestAcceptedAlert),\n                          () => $('#swh-origin-save-request-status').html(saveRequestPendingAlert),\n                          (statusCode, errorData) => {\n                            $('#swh-origin-save-request-status').css('color', 'red');\n                            if (statusCode === 403) {\n                              const errorAlert = htmlAlert('danger', `Error: ${errorData['detail']}`);\n                              $('#swh-origin-save-request-status').html(errorAlert);\n                            } else if (statusCode === 429) {\n                              $('#swh-origin-save-request-status').html(saveRequestRateLimitedAlert);\n                            } else {\n                              $('#swh-origin-save-request-status').html(saveRequestUnknownErrorAlert);\n                            }\n                          });\n      } else {\n        $(event.target).addClass('was-validated');\n      }\n    });\n\n    $('#swh-show-origin-save-requests-list').on('click', (event) => {\n      event.preventDefault();\n      $('.nav-tabs a[href=\"#swh-origin-save-requests-list\"]').tab('show');\n    });\n\n    $('#swh-input-origin-url').on('input', function(event) {\n      let originUrl = $(this).val().trim();\n      $(this).val(originUrl);\n      $('#swh-input-visit-type option').each(function() {\n        let val = $(this).val();\n        if (val && originUrl.includes(val)) {\n          $(this).prop('selected', true);\n        }\n      });\n    });\n\n    if (window.location.hash === '#requests') {\n      $('.nav-tabs a[href=\"#swh-origin-save-requests-list\"]').tab('show');\n    }\n\n  });\n\n}\n\nexport function validateSaveOriginUrl(input) {\n  let originType = $('#swh-input-visit-type').val();\n  let originUrl = null;\n  let validUrl = true;\n\n  try {\n    originUrl = new URL(input.value.trim());\n  } catch (TypeError) {\n    validUrl = false;\n  }\n\n  if (validUrl) {\n    let allowedProtocols = ['http:', 'https:', 'svn:', 'git:'];\n    validUrl = (\n      allowedProtocols.find(protocol => protocol === originUrl.protocol) !== undefined\n    );\n  }\n\n  if (validUrl && originType === 'git') {\n    // additional checks for well known code hosting providers\n    switch (originUrl.hostname) {\n      case 'github.com':\n        validUrl = isGitRepoUrl(originUrl);\n        break;\n\n      case 'git.code.sf.net':\n        validUrl = isGitRepoUrl(originUrl, '/p/');\n        break;\n\n      case 'bitbucket.org':\n        validUrl = isGitRepoUrl(originUrl);\n        break;\n\n      default:\n        if (originUrl.hostname.startsWith('gitlab.')) {\n          validUrl = isGitRepoUrl(originUrl);\n        }\n        break;\n    }\n  }\n\n  if (validUrl) {\n    input.setCustomValidity('');\n  } else {\n    input.setCustomValidity('The origin url is not valid or does not reference a code repository');\n  }\n}\n\nexport function initTakeNewSnapshot() {\n\n  let newSnapshotRequestAcceptedAlert = htmlAlert(\n    'success',\n    'The \"take new snapshot\" request has been accepted and will be processed as soon as possible.',\n    true\n  );\n\n  let newSnapshotRequestPendingAlert = htmlAlert(\n    'warning',\n    'The \"take new snapshot\" request has been put in pending state and may be accepted for processing after manual review.',\n    true\n  );\n\n  let newSnapshotRequestRateLimitAlert = htmlAlert(\n    'danger',\n    'The rate limit for \"take new snapshot\" requests has been reached. Please try again later.',\n    true\n  );\n\n  let newSnapshotRequestUnknownErrorAlert = htmlAlert(\n    'danger',\n    'An unexpected error happened when submitting the \"save code now request\".',\n    true\n  );\n\n  $(document).ready(() => {\n    $('#swh-take-new-snapshot-form').submit(event => {\n      event.preventDefault();\n      event.stopPropagation();\n\n      let originType = $('#swh-input-visit-type').val();\n      let originUrl = $('#swh-input-origin-url').val();\n\n      originSaveRequest(originType, originUrl,\n                        () => $('#swh-take-new-snapshot-request-status').html(newSnapshotRequestAcceptedAlert),\n                        () => $('#swh-take-new-snapshot-request-status').html(newSnapshotRequestPendingAlert),\n                        (statusCode, errorData) => {\n                          $('#swh-take-new-snapshot-request-status').css('color', 'red');\n                          if (statusCode === 403) {\n                            const errorAlert = htmlAlert('danger', `Error: ${errorData['detail']}`, true);\n                            $('#swh-take-new-snapshot-request-status').html(errorAlert);\n                          } else if (statusCode === 429) {\n                            $('#swh-take-new-snapshot-request-status').html(newSnapshotRequestRateLimitAlert);\n                          } else {\n                            $('#swh-take-new-snapshot-request-status').html(newSnapshotRequestUnknownErrorAlert);\n                          }\n                        });\n    });\n  });\n}\n\nexport function formatValuePerType(type, value) {\n  // Given some typed value, format and return accordingly formatted value\n  const mapFormatPerTypeFn = {\n    'json': (v) => JSON.stringify(v, null, 2),\n    'date': (v) => new Date(v).toLocaleString(),\n    'raw': (v) => v,\n    'duration': (v) => v + ' seconds'\n  };\n\n  return value === null ? null : mapFormatPerTypeFn[type](value);\n}\n\nexport function displaySaveRequestInfo(event, saveRequestId) {\n  event.stopPropagation();\n  const saveRequestTaskInfoUrl = Urls.origin_save_task_info(saveRequestId);\n  // close popover when clicking again on the info icon\n  if ($(event.target).data('bs.popover')) {\n    $(event.target).popover('dispose');\n    return;\n  }\n  $('.swh-save-request-info').popover('dispose');\n  $(event.target).popover({\n    animation: false,\n    boundary: 'viewport',\n    container: 'body',\n    title: 'Save request task information ' +\n             '<i style=\"cursor: pointer; position: absolute; right: 1rem;\" ' +\n             `class=\"mdi mdi-close swh-save-request-info-close\"></i>`,\n    content: `<div class=\"swh-popover swh-save-request-info-popover\">\n                  <div class=\"text-center\">\n                    <img src=${swhSpinnerSrc}></img>\n                    <p>Fetching task information ...</p>\n                  </div>\n                </div>`,\n    html: true,\n    placement: 'left',\n    sanitizeFn: swh.webapp.filterXSS\n  });\n\n  $(event.target).on('shown.bs.popover', function() {\n    const popoverId = $(this).attr('aria-describedby');\n    $(`#${popoverId} .mdi-close`).click(() => {\n      $(this).popover('dispose');\n    });\n  });\n\n  $(event.target).popover('show');\n  fetch(saveRequestTaskInfoUrl)\n    .then(response => response.json())\n    .then(saveRequestTaskInfo => {\n      let content;\n      if ($.isEmptyObject(saveRequestTaskInfo)) {\n        content = 'Not available';\n      } else {\n        let saveRequestInfo = [];\n        const taskData = {\n          'Type': ['raw', 'type'],\n          'Visit status': ['raw', 'visit_status'],\n          'Arguments': ['json', 'arguments'],\n          'Id': ['raw', 'id'],\n          'Backend id': ['raw', 'backend_id'],\n          'Scheduling date': ['date', 'scheduled'],\n          'Start date': ['date', 'started'],\n          'Completion date': ['date', 'ended'],\n          'Duration': ['duration', 'duration'],\n          'Runner': ['raw', 'worker'],\n          'Log': ['raw', 'message']\n        };\n        for (const [title, [type, property]] of Object.entries(taskData)) {\n          if (saveRequestTaskInfo.hasOwnProperty(property)) {\n            saveRequestInfo.push({\n              key: title,\n              value: formatValuePerType(type, saveRequestTaskInfo[property])\n            });\n          }\n        }\n        content = '<table class=\"table\"><tbody>';\n        for (let info of saveRequestInfo) {\n          content +=\n            `<tr>\n              <th class=\"swh-metadata-table-row swh-metadata-table-key\">${info.key}</th>\n              <td class=\"swh-metadata-table-row swh-metadata-table-value\">\n                <pre>${info.value}</pre>\n              </td>\n            </tr>`;\n        }\n        content += '</tbody></table>';\n      }\n      $('.swh-popover').html(content);\n      $(event.target).popover('update');\n    });\n}\n\nexport function fillSaveRequestFormAndScroll(visitType, originUrl) {\n  $('#swh-input-origin-url').val(originUrl);\n  let originTypeFound = false;\n  $('#swh-input-visit-type option').each(function() {\n    let val = $(this).val();\n    if (val && originUrl.includes(val)) {\n      $(this).prop('selected', true);\n      originTypeFound = true;\n    }\n  });\n  if (!originTypeFound) {\n    $('#swh-input-visit-type option').each(function() {\n      let val = $(this).val();\n      if (val === visitType) {\n        $(this).prop('selected', true);\n      }\n    });\n  }\n  window.scrollTo(0, 0);\n}\n"],"sourceRoot":""}