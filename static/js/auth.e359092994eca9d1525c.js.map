{"version":3,"sources":["webpack://swh.auth/webpack/universalModuleDefinition","webpack://swh.auth/webpack/bootstrap","webpack://swh.auth/./swh/web/assets/src/utils/functions.js","webpack://swh.auth/./swh/web/assets/src/bundles/auth/index.js"],"names":["root","factory","exports","module","define","amd","window","installedModules","__webpack_require__","moduleId","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","handleFetchError","response","ok","handleFetchErrors","responses","length","staticAsset","asset","__STATIC__","csrfPost","url","headers","body","Cookies","fetch","credentials","method","isGitRepoUrl","domain","RegExp","test","removeUrlFragment","history","replaceState","document","title","location","pathname","search","selectText","startNode","endNode","selection","getSelection","removeAllRanges","range","createRange","setStart","nodeName","setEnd","childNodes","textContent","addRange","htmlAlert","type","message","closable","closeButton","extraClasses","apiTokensTable","updateSubmitButtonState","val","$","prop","errorMessage","successMessage","disableSubmitButton","off","generateToken","Urls","oidc_generate_bearer_token","JSON","stringify","password","then","text","token","tokenHtml","append","draw","status","displayToken","tokenId","postData","token_id","oidc_get_bearer_token","revokeTokens","tokenIds","token_ids","oidc_revoke_bearer_tokens","revokeToken","revokeAllTokens","rowsData","rows","data","push","id","applyTokenAction","action","actionData","generate","modalTitle","infoText","buttonText","submitCallback","display","revoke","revokeAll","passwordFormHtml","swh","webapp","showModalHtml","change","keyup","submit","event","preventDefault","stopPropagation","initProfilePage","ready","on","e","settings","techNote","console","log","DataTable","serverSide","ajax","oidc_list_bearer_tokens","columns","render","row","Date","toLocaleString","ordering","searching","scrollY","scrollCollapse","hash","tab"],"mappings":"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","file":"js/auth.e359092994eca9d1525c.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"auth\"] = factory();\n\telse\n\t\troot[\"swh\"] = root[\"swh\"] || {}, root[\"swh\"][\"auth\"] = factory();\n})(window, function() {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/static/\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 253);\n","/**\n * Copyright (C) 2018-2020  The Software Heritage developers\n * See the AUTHORS file at the top-level directory of this distribution\n * License: GNU Affero General Public License version 3, or any later version\n * See top-level LICENSE file for more information\n */\n\n// utility functions\n\nexport function handleFetchError(response) {\n  if (!response.ok) {\n    throw response;\n  }\n  return response;\n}\n\nexport function handleFetchErrors(responses) {\n  for (let i = 0; i < responses.length; ++i) {\n    if (!responses[i].ok) {\n      throw responses[i];\n    }\n  }\n  return responses;\n}\n\nexport function staticAsset(asset) {\n  return `${__STATIC__}${asset}`;\n}\n\nexport function csrfPost(url, headers = {}, body = null) {\n  headers['X-CSRFToken'] = Cookies.get('csrftoken');\n  return fetch(url, {\n    credentials: 'include',\n    headers: headers,\n    method: 'POST',\n    body: body\n  });\n}\n\nexport function isGitRepoUrl(url, domain) {\n  let endOfPattern = '\\\\/[\\\\w\\\\.-]+\\\\/?(?!=.git)(?:\\\\.git(?:\\\\/?|\\\\#[\\\\w\\\\.\\\\-_]+)?)?$';\n  let pattern = `(?:git|https?|git@)(?:\\\\:\\\\/\\\\/)?${domain}[/|:][A-Za-z0-9-/]+?` + endOfPattern;\n  let re = new RegExp(pattern);\n  return re.test(url);\n};\n\nexport function removeUrlFragment() {\n  history.replaceState('', document.title, window.location.pathname + window.location.search);\n}\n\nexport function selectText(startNode, endNode) {\n  let selection = window.getSelection();\n  selection.removeAllRanges();\n  let range = document.createRange();\n  range.setStart(startNode, 0);\n  if (endNode.nodeName !== '#text') {\n    range.setEnd(endNode, endNode.childNodes.length);\n  } else {\n    range.setEnd(endNode, endNode.textContent.length);\n  }\n  selection.addRange(range);\n}\n\nexport function htmlAlert(type, message, closable = false) {\n  let closeButton = '';\n  let extraClasses = '';\n  if (closable) {\n    closeButton =\n      `<button type=\"button\" class=\"close\" data-dismiss=\"alert\" aria-label=\"Close\">\n        <span aria-hidden=\"true\">&times;</span>\n      </button>`;\n    extraClasses = 'alert-dismissible';\n  }\n  return `<div class=\"alert alert-${type} ${extraClasses}\" role=\"alert\">${message}${closeButton}</div>`;\n}\n","/**\n * Copyright (C) 2020  The Software Heritage developers\n * See the AUTHORS file at the top-level directory of this distribution\n * License: GNU Affero General Public License version 3, or any later version\n * See top-level LICENSE file for more information\n */\n\nimport {handleFetchError, csrfPost, removeUrlFragment} from 'utils/functions';\nimport './auth.css';\n\nlet apiTokensTable;\n\nfunction updateSubmitButtonState() {\n  const val = $('#swh-user-password').val();\n  $('#swh-user-password-submit').prop('disabled', val.length === 0);\n}\n\nfunction passwordForm(infoText, buttonText) {\n  const form =\n    `<form id=\"swh-password-form\">\n      <p id=\"swh-password-form-text\">${infoText}</p>\n      <label for=\"swh-user-password\">Password:&nbsp;</label>\n      <input id=\"swh-user-password\" type=\"password\" name=\"swh-user-password\" required>\n      <input id=\"swh-user-password-submit\" type=\"submit\" value=\"${buttonText}\" disabled>\n    </form>`;\n  return form;\n}\n\nfunction errorMessage(message) {\n  return `<p id=\"swh-token-error-message\" class=\"mt-3\">${message}</p>`;\n}\n\nfunction successMessage(message) {\n  return `<p id=\"swh-token-success-message\" class=\"mt-3\">${message}</p>`;\n}\n\nfunction disableSubmitButton() {\n  $('#swh-user-password-submit').prop('disabled', true);\n  $('#swh-user-password').off('change');\n  $('#swh-user-password').off('keyup');\n}\n\nfunction generateToken() {\n  csrfPost(Urls.oidc_generate_bearer_token(), {},\n           JSON.stringify({password: $('#swh-user-password').val()}))\n    .then(handleFetchError)\n    .then(response => response.text())\n    .then(token => {\n      disableSubmitButton();\n      const tokenHtml =\n        `${successMessage('Below is your token.')}\n         <pre id=\"swh-bearer-token\">${token}</pre>`;\n      $(`#swh-password-form`).append(tokenHtml);\n      apiTokensTable.draw();\n    })\n    .catch(response => {\n      if (response.status === 400) {\n        $(`#swh-password-form`).append(\n          errorMessage('You are not allowed to generate bearer tokens.'));\n      } else if (response.status === 401) {\n        $(`#swh-password-form`).append(errorMessage('The password is invalid.'));\n      } else {\n        $(`#swh-password-form`).append(errorMessage('Internal server error.'));\n      }\n    });\n}\n\nfunction displayToken(tokenId) {\n  const postData = {\n    password: $('#swh-user-password').val(),\n    token_id: tokenId\n  };\n  csrfPost(Urls.oidc_get_bearer_token(), {}, JSON.stringify(postData))\n    .then(handleFetchError)\n    .then(response => response.text())\n    .then(token => {\n      disableSubmitButton();\n      const tokenHtml =\n        `${successMessage('Below is your token.')}\n         <pre id=\"swh-bearer-token\">${token}</pre>`;\n      $(`#swh-password-form`).append(tokenHtml);\n    })\n    .catch(response => {\n      if (response.status === 401) {\n        $(`#swh-password-form`).append(errorMessage('The password is invalid.'));\n      } else {\n        $(`#swh-password-form`).append(errorMessage('Internal server error.'));\n      }\n    });\n}\n\nfunction revokeTokens(tokenIds) {\n  const postData = {\n    password: $('#swh-user-password').val(),\n    token_ids: tokenIds\n  };\n  csrfPost(Urls.oidc_revoke_bearer_tokens(), {}, JSON.stringify(postData))\n    .then(handleFetchError)\n    .then(() => {\n      disableSubmitButton();\n      $(`#swh-password-form`).append(\n        successMessage(`Bearer token${tokenIds.length > 1 ? 's' : ''} successfully revoked`));\n      apiTokensTable.draw();\n    })\n    .catch(response => {\n      if (response.status === 401) {\n        $(`#swh-password-form`).append(errorMessage('The password is invalid.'));\n      } else {\n        $(`#swh-password-form`).append(errorMessage('Internal server error.'));\n      }\n    });\n}\n\nfunction revokeToken(tokenId) {\n  revokeTokens([tokenId]);\n}\n\nfunction revokeAllTokens() {\n  const tokenIds = [];\n  const rowsData = apiTokensTable.rows().data();\n  for (let i = 0; i < rowsData.length; ++i) {\n    tokenIds.push(rowsData[i].id);\n  }\n  revokeTokens(tokenIds);\n}\n\nexport function applyTokenAction(action, tokenId) {\n  const actionData = {\n    generate: {\n      modalTitle: 'Bearer token generation',\n      infoText: 'Enter your password and click on the button to generate the token.',\n      buttonText: 'Generate token',\n      submitCallback: generateToken\n    },\n    display: {\n      modalTitle: 'Display bearer token',\n      infoText: 'Enter your password and click on the button to display the token.',\n      buttonText: 'Display token',\n      submitCallback: displayToken\n    },\n    revoke: {\n      modalTitle: 'Revoke bearer token',\n      infoText: 'Enter your password and click on the button to revoke the token.',\n      buttonText: 'Revoke token',\n      submitCallback: revokeToken\n    },\n    revokeAll: {\n      modalTitle: 'Revoke all bearer tokens',\n      infoText: 'Enter your password and click on the button to revoke all tokens.',\n      buttonText: 'Revoke tokens',\n      submitCallback: revokeAllTokens\n    }\n  };\n\n  if (!actionData[action]) {\n    return;\n  }\n\n  const passwordFormHtml = passwordForm(\n    actionData[action].infoText, actionData[action].buttonText);\n\n  swh.webapp.showModalHtml(actionData[action].modalTitle, passwordFormHtml);\n  $('#swh-user-password').change(updateSubmitButtonState);\n  $('#swh-user-password').keyup(updateSubmitButtonState);\n  $(`#swh-password-form`).submit(event => {\n    event.preventDefault();\n    event.stopPropagation();\n    actionData[action].submitCallback(tokenId);\n  });\n}\n\nexport function initProfilePage() {\n  $(document).ready(() => {\n    apiTokensTable = $('#swh-bearer-tokens-table')\n      .on('error.dt', (e, settings, techNote, message) => {\n        $('#swh-origin-save-request-list-error').text(\n          'An error occurred while retrieving the tokens list');\n        console.log(message);\n      })\n      .DataTable({\n        serverSide: true,\n        ajax: Urls.oidc_list_bearer_tokens(),\n        columns: [\n          {\n            data: 'creation_date',\n            name: 'creation_date',\n            render: (data, type, row) => {\n              if (type === 'display') {\n                let date = new Date(data);\n                return date.toLocaleString();\n              }\n              return data;\n            }\n          },\n          {\n            render: (data, type, row) => {\n              const html =\n                `<button class=\"btn btn-default\"\n                         onclick=\"swh.auth.applyTokenAction('display', ${row.id})\">\n                  Display token\n                </button>\n                <button class=\"btn btn-default\"\n                        onclick=\"swh.auth.applyTokenAction('revoke', ${row.id})\">\n                  Revoke token\n                </button>`;\n              return html;\n            }\n          }\n        ],\n        ordering: false,\n        searching: false,\n        scrollY: '50vh',\n        scrollCollapse: true\n      });\n    $('#swh-oidc-profile-tokens-tab').on('shown.bs.tab', () => {\n      apiTokensTable.draw();\n      window.location.hash = '#tokens';\n    });\n    $('#swh-oidc-profile-account-tab').on('shown.bs.tab', () => {\n      removeUrlFragment();\n    });\n    if (window.location.hash === '#tokens') {\n      $('.nav-tabs a[href=\"#swh-oidc-profile-tokens\"]').tab('show');\n    }\n  });\n}\n"],"sourceRoot":""}