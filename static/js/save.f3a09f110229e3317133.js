!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.swh=t():(e.swh=e.swh||{},e.swh.save=t())}(self,(function(){return function(){var __webpack_modules__={80893:function(e,t,n){"use strict";n.d(t,{XC:function(){return r}});var r=(0,n(55423).TT)("img/swh-spinner.gif")},55423:function(e,t,n){"use strict";function r(e){if(!e.ok)throw e;return e}function a(e){return"/static/"+e}function s(e,t,n){return void 0===t&&(t={}),void 0===n&&(n=null),t["X-CSRFToken"]=Cookies.get("csrftoken"),fetch(e,{credentials:"include",headers:t,method:"POST",body:n})}function i(e,t){void 0===t&&(t="/");return void 0!==["http:","https:","git:"].find((function(t){return t===e.protocol}))&&(!!e.pathname.startsWith(t)&&new RegExp("[\\w\\.-]+\\/?(?!=.git)(?:\\.git\\/?)?$").test(e.pathname.slice(t.length)))}function o(){history.replaceState("",document.title,window.location.pathname+window.location.search)}function u(e,t,n){void 0===n&&(n=!1);var r="",a="";return n&&(r='<button type="button" class="close" data-dismiss="alert" aria-label="Close">\n        <span aria-hidden="true">&times;</span>\n      </button>',a="alert-dismissible"),'<div class="alert alert-'+e+" "+a+'" role="alert">'+t+r+"</div>"}n.d(t,{ry:function(){return r},TT:function(){return a},e_:function(){return s},Eg:function(){return i},L3:function(){return o},EM:function(){return u}})},31652:function(module){module.exports=function anonymous(locals,escapeFn,include,rethrow){escapeFn=escapeFn||function(e){return null==e?"":String(e).replace(_MATCH_HTML,encode_char)};var _ENCODE_HTML_RULES={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&#34;","'":"&#39;"},_MATCH_HTML=/[&<>'"]/g;function encode_char(e){return _ENCODE_HTML_RULES[e]||e}var __output="";function __append(e){null!=e&&(__output+=e)}with(locals||{})__append('\n\n<div class="swh-save-origin-archives-form swh-save-origin-artifact-form form-row">\n  <div class="form-group col-md-7">\n    <label for="swh-input-artifact-url-'),__append(escapeFn(formId)),__append('">Artifact url</label>\n    <input type="text" class="form-control" id="swh-input-artifact-url-'),__append(escapeFn(formId)),__append('" required>\n    <div class="invalid-feedback">The artifact url is mandatory</div>\n  </div>\n  <div class="form-group col-md-2">\n    <label for="swh-input-artifact-version-'),__append(escapeFn(formId)),__append('">Artifact version</label>\n    <input type="text" class="form-control" id="swh-input-artifact-version-'),__append(escapeFn(formId)),__append('" required>\n    <div class="invalid-feedback">The artifact version is mandatory</div>\n  </div>\n  <div class="col-md-2">\n    '),deletableRow?(__append('\n      <label for="swh-remove-archive-artifact-'),__append(escapeFn(formId)),__append('">&nbsp;</label>\n      <button id="swh-remove-archive-artifact-'),__append(escapeFn(formId)),__append('" type="button" class="btn btn-default btn-block" onclick="swh.save.deleteArtifactFormRow(event)">\n              <i class="mdi mdi-file-remove mdi-fw" aria-hidden="true"></i>Remove artifact\n      </button>\n    ')):__append('\n      <label for="swh-add-archive-artifact">&nbsp;</label>\n      <button id="swh-add-archive-artifact" type="button" class="btn btn-default btn-block" onclick="swh.save.addArtifactFormRow()">\n        <i class="mdi mdi-file-plus mdi-fw" aria-hidden="true"></i>Add artifact\n      </button>\n    '),__append("\n  </div>\n</div>");return __output}}},__webpack_module_cache__={};function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var n=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e](n,n.exports,__webpack_require__),n.exports}__webpack_require__.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return __webpack_require__.d(t,{a:t}),t},__webpack_require__.d=function(e,t){for(var n in t)__webpack_require__.o(t,n)&&!__webpack_require__.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},__webpack_require__.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},__webpack_require__.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var __webpack_exports__={};return function(){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{maybeRequireExtraInputs:function(){return c},addArtifactFormRow:function(){return l},deleteArtifactFormRow:function(){return d},initOriginSave:function(){return p},validateSaveOriginUrl:function(){return f},initTakeNewSnapshot:function(){return h},formatValuePerType:function(){return v},displaySaveRequestInfo:function(){return _},fillSaveRequestFormAndScroll:function(){return w}});var e,t=__webpack_require__(55423),n=__webpack_require__(80893),r=__webpack_require__(31652),a=__webpack_require__.n(r);function s(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return i(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return i(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function o(e,n,r,a,s,i){var o=Urls.api_1_save_origin(e,n);$(".swh-processing-save-request").css("display","block");var u={},c=null;r!=={}&&(c=JSON.stringify(r),u={"Content-Type":"application/json"}),(0,t.e_)(o,u,c).then(t.ry).then((function(e){return e.json()})).then((function(e){$(".swh-processing-save-request").css("display","none"),"accepted"===e.save_request_status?a():s()})).catch((function(e){$(".swh-processing-save-request").css("display","none"),e.json().then((function(t){i(e.status,t)}))}))}function u(e){$("#swh-input-artifact-url-"+e).on("input",(function(t){var n=$(this).val().trim(),r=n.split("/").slice(-1)[0];if(r!==n){var a=(r=r.replace(/tar.*$/,"tar")).split(".").slice(0,-1).join("."),s=$("#swh-input-artifact-version-"+e);a!==r&&s.val(a)}}))}function c(){var e=$("#swh-input-visit-type").val(),t="none",n=!0;"archives"===e&&(t="flex",n=!1),$(".swh-save-origin-archives-form").css("display",t),n||$("#swh-save-origin-archives-help").css("display","block"),$(".swh-save-origin-archives-form .form-control").prop("disabled",n),"archives"===e&&1===$(".swh-save-origin-archives-form").length&&($(".swh-save-origin-archives-form").last().after(a()({deletableRow:!1,formId:0})),u(0))}function l(){var e=$(".swh-save-origin-artifact-form").length;$(".swh-save-origin-artifact-form").last().after(a()({deletableRow:!0,formId:e})),u(e)}function d(e){$(e.target).closest(".swh-save-origin-artifact-form").remove()}function p(){$(document).ready((function(){$.fn.dataTable.ext.errMode="none",fetch(Urls.origin_save_types_list()).then((function(e){return e.json()})).then((function(e){for(var t,n=s(e);!(t=n()).done;){var r=t.value;$("#swh-input-visit-type").append('<option value="'+r+'">'+r+"</option>")}$("#swh-input-visit-type").val("git")})),e=$("#swh-origin-save-requests").on("error.dt",(function(e,t,n,r){$("#swh-origin-save-request-list-error").text("An error occurred while retrieving the save requests list"),console.log(r)})).DataTable({serverSide:!0,processing:!0,language:{processing:'<img src="'+n.XC+'"></img>'},ajax:{url:Urls.origin_save_requests_list("all"),data:function(e){swh.webapp.isUserLoggedIn()&&$("#swh-save-requests-user-filter").prop("checked")&&(e.user_requests_only="1")}},searchDelay:1e3,dom:'<"row"<"col-sm-3"l><"col-sm-6 text-left user-requests-filter"><"col-sm-3"f>><"row"<"col-sm-12"tr>><"row"<"col-sm-5"i><"col-sm-7"p>>',fnInitComplete:function(){swh.webapp.isUserLoggedIn()&&($("div.user-requests-filter").html('\n<div class="custom-control custom-checkbox swhid-option">\n  <input class="custom-control-input" value="option-user-requests-filter" type="checkbox"\n         id="swh-save-requests-user-filter">\n  <label class="custom-control-label font-weight-normal" for="swh-save-requests-user-filter">\n    show only your own requests\n  </label>\n</div>\n'),$("#swh-save-requests-user-filter").on("change",(function(){e.draw()})))},columns:[{data:"save_request_date",name:"request_date",render:function(e,t,n){return"display"===t?new Date(e).toLocaleString():e}},{data:"visit_type",name:"visit_type"},{data:"origin_url",name:"origin_url",render:function(e,t,n){if("display"===t){var r="",a=$.fn.dataTable.render.text().display(e);if("succeeded"===n.save_task_status){var s=Urls.browse_origin()+"?origin_url="+encodeURIComponent(a);n.visit_date&&(s+="&amp;timestamp="+encodeURIComponent(n.visit_date)),r+='<a href="'+s+'">'+a+"</a>"}else r+=a;return r+='&nbsp;<a href="'+a+'"><i class="mdi mdi-open-in-new" aria-hidden="true"></i></a>'}return e}},{data:"save_request_status",name:"status"},{data:"save_task_status",name:"loading_task_status"},{name:"info",render:function(e,t,n){return"succeeded"===n.save_task_status||"failed"===n.save_task_status?'<i class="mdi mdi-information-outline swh-save-request-info" aria-hidden="true" style="cursor: pointer"onclick="swh.save.displaySaveRequestInfo(event, '+n.id+')"></i>':""}},{render:function(e,t,n){return"accepted"===n.save_request_status?'<button class="btn btn-default btn-sm swh-save-origin-again" type="button" onclick="swh.save.fillSaveRequestFormAndScroll(\''+n.visit_type+"', '"+n.origin_url+'\');"><i class="mdi mdi-camera mdi-fw" aria-hidden="true"></i>Save again</button>':""}}],scrollY:"50vh",scrollCollapse:!0,order:[[0,"desc"]],responsive:{details:{type:"none"}}}),swh.webapp.addJumpToPagePopoverToDataTable(e),$("#swh-origin-save-requests-list-tab").on("shown.bs.tab",(function(){e.draw(),window.location.hash="#requests"})),$("#swh-origin-save-request-help-tab").on("shown.bs.tab",(function(){(0,t.L3)(),$(".swh-save-request-info").popover("dispose")}));var r=(0,t.EM)("success",'The "save code now" request has been accepted and will be processed as soon as possible.',!0),a=(0,t.EM)("warning",'The "save code now" request has been put in pending state and may be accepted for processing after manual review.',!0),i=(0,t.EM)("danger",'The rate limit for "save code now" requests has been reached. Please try again later.',!0),u=(0,t.EM)("danger",'An unexpected error happened when submitting the "save code now request".',!0);$("#swh-save-origin-form").submit((function(e){if(e.preventDefault(),e.stopPropagation(),$(".alert").alert("close"),e.target.checkValidity()){$(e.target).removeClass("was-validated");var n=$("#swh-input-visit-type").val(),s=$("#swh-input-origin-url").val(),c={};if("archives"===n){c.archives_data=[];for(var l=0;l<$(".swh-save-origin-artifact-form").length;++l)c.archives_data.push({artifact_url:$("#swh-input-artifact-url-"+l).val(),artifact_version:$("#swh-input-artifact-version-"+l).val()})}o(n,s,c,(function(){return $("#swh-origin-save-request-status").html(r)}),(function(){return $("#swh-origin-save-request-status").html(a)}),(function(e,n){if($("#swh-origin-save-request-status").css("color","red"),403===e){var r=(0,t.EM)("danger","Error: "+n.reason);$("#swh-origin-save-request-status").html(r)}else if(429===e)$("#swh-origin-save-request-status").html(i);else if(400===e){var a=(0,t.EM)("danger",n.reason);$("#swh-origin-save-request-status").html(a)}else $("#swh-origin-save-request-status").html(u)}))}else $(e.target).addClass("was-validated")})),$("#swh-show-origin-save-requests-list").on("click",(function(e){e.preventDefault(),$('.nav-tabs a[href="#swh-origin-save-requests-list"]').tab("show")})),$("#swh-input-origin-url").on("input",(function(e){var t=$(this).val().trim();$(this).val(t),$("#swh-input-visit-type option").each((function(){var e=$(this).val();e&&t.includes(e)&&$(this).prop("selected",!0)}))})),"#requests"===window.location.hash&&$('.nav-tabs a[href="#swh-origin-save-requests-list"]').tab("show")}))}function f(e){var n=$("#swh-input-visit-type").val(),r=null,a=!0;try{r=new URL(e.value.trim())}catch(e){a=!1}if(a){a=void 0!==["http:","https:","svn:","git:"].find((function(e){return e===r.protocol}))}if(a&&"git"===n)switch(r.hostname){case"github.com":a=(0,t.Eg)(r);break;case"git.code.sf.net":a=(0,t.Eg)(r,"/p/");break;case"bitbucket.org":a=(0,t.Eg)(r);break;default:r.hostname.startsWith("gitlab.")&&(a=(0,t.Eg)(r))}a?e.setCustomValidity(""):e.setCustomValidity("The origin url is not valid or does not reference a code repository")}function h(){var e=(0,t.EM)("success",'The "take new snapshot" request has been accepted and will be processed as soon as possible.',!0),n=(0,t.EM)("warning",'The "take new snapshot" request has been put in pending state and may be accepted for processing after manual review.',!0),r=(0,t.EM)("danger",'The rate limit for "take new snapshot" requests has been reached. Please try again later.',!0),a=(0,t.EM)("danger",'An unexpected error happened when submitting the "save code now request".',!0);$(document).ready((function(){$("#swh-take-new-snapshot-form").submit((function(s){s.preventDefault(),s.stopPropagation();o($("#swh-input-visit-type").val(),$("#swh-input-origin-url").val(),{},(function(){return $("#swh-take-new-snapshot-request-status").html(e)}),(function(){return $("#swh-take-new-snapshot-request-status").html(n)}),(function(e,n){if($("#swh-take-new-snapshot-request-status").css("color","red"),403===e){var s=(0,t.EM)("danger","Error: "+n.detail,!0);$("#swh-take-new-snapshot-request-status").html(s)}else 429===e?$("#swh-take-new-snapshot-request-status").html(r):$("#swh-take-new-snapshot-request-status").html(a)}))}))}))}function v(e,t){return null===t?null:{json:function(e){return JSON.stringify(e,null,2)},date:function(e){return new Date(e).toLocaleString()},raw:function(e){return e},duration:function(e){return e+" seconds"}}[e](t)}function _(e,t){e.stopPropagation();var r=Urls.origin_save_task_info(t);$(e.target).data("bs.popover")?$(e.target).popover("dispose"):($(".swh-save-request-info").popover("dispose"),$(e.target).popover({animation:!1,boundary:"viewport",container:"body",title:'Save request task information <i style="cursor: pointer; position: absolute; right: 1rem;" class="mdi mdi-close swh-save-request-info-close"></i>',content:'<div class="swh-popover swh-save-request-info-popover">\n                  <div class="text-center">\n                    <img src='+n.XC+"></img>\n                    <p>Fetching task information ...</p>\n                  </div>\n                </div>",html:!0,placement:"left",sanitizeFn:swh.webapp.filterXSS}),$(e.target).on("shown.bs.popover",(function(){var e=this,t=$(this).attr("aria-describedby");$("#"+t+" .mdi-close").click((function(){$(e).popover("dispose")}))})),$(e.target).popover("show"),fetch(r).then((function(e){return e.json()})).then((function(t){var n;if($.isEmptyObject(t))n="Not available";else{for(var r=[],a=0,s=Object.entries({Type:["raw","type"],"Visit status":["raw","visit_status"],Arguments:["json","arguments"],Id:["raw","id"],"Backend id":["raw","backend_id"],"Scheduling date":["date","scheduled"],"Start date":["date","started"],"Completion date":["date","ended"],Duration:["duration","duration"],Runner:["raw","worker"],Log:["raw","message"]});a<s.length;a++){var i=s[a],o=i[0],u=i[1],c=u[0],l=u[1];t.hasOwnProperty(l)&&r.push({key:o,value:v(c,t[l])})}n='<table class="table"><tbody>';for(var d=0,p=r;d<p.length;d++){var f=p[d];n+='<tr>\n              <th class="swh-metadata-table-row swh-metadata-table-key">'+f.key+'</th>\n              <td class="swh-metadata-table-row swh-metadata-table-value">\n                <pre>'+f.value+"</pre>\n              </td>\n            </tr>"}n+="</tbody></table>"}$(".swh-popover").html(n),$(e.target).popover("update")})))}function w(e,t){$("#swh-input-origin-url").val(t);var n=!1;$("#swh-input-visit-type option").each((function(){var e=$(this).val();e&&t.includes(e)&&($(this).prop("selected",!0),n=!0)})),n||$("#swh-input-visit-type option").each((function(){$(this).val()===e&&$(this).prop("selected",!0)})),window.scrollTo(0,0)}}(),__webpack_exports__}()}));
//# sourceMappingURL=save.f3a09f110229e3317133.js.map