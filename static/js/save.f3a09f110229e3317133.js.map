{"version":3,"sources":["webpack://swh.save/webpack/universalModuleDefinition","webpack://swh.save/./assets/src/utils/constants.js","webpack://swh.save/./assets/src/utils/functions.js","webpack://swh.save/./assets/src/bundles/save/artifact-form-row.ejs","webpack://swh.save/webpack/bootstrap","webpack://swh.save/webpack/runtime/compat get default export","webpack://swh.save/webpack/runtime/define property getters","webpack://swh.save/webpack/runtime/hasOwnProperty shorthand","webpack://swh.save/webpack/runtime/make namespace object","webpack://swh.save/./assets/src/bundles/save/index.js"],"names":["root","factory","exports","module","define","amd","self","swhSpinnerSrc","staticAsset","handleFetchError","response","ok","asset","__STATIC__","csrfPost","url","headers","body","Cookies","get","fetch","credentials","method","isGitRepoUrl","pathPrefix","undefined","find","protocol","pathname","startsWith","RegExp","test","slice","length","removeUrlFragment","history","replaceState","document","title","window","location","search","htmlAlert","type","message","closable","closeButton","extraClasses","anonymous","locals","escapeFn","include","rethrow","markup","String","replace","_MATCH_HTML","encode_char","_ENCODE_HTML_RULES","c","__output","__append","s","formId","deletableRow","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","__webpack_modules__","n","getter","__esModule","d","a","definition","key","o","Object","defineProperty","enumerable","obj","prop","prototype","hasOwnProperty","call","r","Symbol","toStringTag","value","saveRequestsTable","originSaveRequest","originType","originUrl","extraData","acceptedCallback","pendingCallback","errorCallback","addSaveOriginRequestUrl","Urls","api_1_save_origin","$","css","JSON","stringify","then","json","data","save_request_status","errorData","status","addArtifactVersionAutofillHandler","on","event","artifactUrl","this","val","trim","filename","split","filenameNoExt","join","artifactVersion","maybeRequireExtraInputs","display","disabled","last","after","artifactFormRowTemplate","addArtifactFormRow","deleteArtifactFormRow","target","closest","remove","initOriginSave","ready","fn","dataTable","ext","errMode","origin_save_types_list","append","e","settings","techNote","text","console","log","DataTable","serverSide","processing","language","ajax","origin_save_requests_list","swh","webapp","isUserLoggedIn","user_requests_only","searchDelay","dom","fnInitComplete","html","draw","columns","name","render","row","Date","toLocaleString","sanitizedURL","save_task_status","browseOriginUrl","browse_origin","encodeURIComponent","visit_date","id","visit_type","origin_url","scrollY","scrollCollapse","order","responsive","details","addJumpToPagePopoverToDataTable","hash","popover","saveRequestAcceptedAlert","saveRequestPendingAlert","saveRequestRateLimitedAlert","saveRequestUnknownErrorAlert","submit","preventDefault","stopPropagation","alert","checkValidity","removeClass","i","push","statusCode","errorAlert","addClass","tab","each","includes","validateSaveOriginUrl","input","validUrl","URL","TypeError","hostname","setCustomValidity","initTakeNewSnapshot","newSnapshotRequestAcceptedAlert","newSnapshotRequestPendingAlert","newSnapshotRequestRateLimitAlert","newSnapshotRequestUnknownErrorAlert","formatValuePerType","v","displaySaveRequestInfo","saveRequestId","saveRequestTaskInfoUrl","origin_save_task_info","animation","boundary","container","content","placement","sanitizeFn","filterXSS","popoverId","attr","click","saveRequestTaskInfo","isEmptyObject","saveRequestInfo","entries","property","info","fillSaveRequestFormAndScroll","visitType","originTypeFound","scrollTo"],"mappings":"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","file":"js/save.f3a09f110229e3317133.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"swh\"] = factory();\n\telse\n\t\troot[\"swh\"] = root[\"swh\"] || {}, root[\"swh\"][\"save\"] = factory();\n})(self, function() {\nreturn ","/**\n * Copyright (C) 2019  The Software Heritage developers\n * See the AUTHORS file at the top-level directory of this distribution\n * License: GNU Affero General Public License version 3, or any later version\n * See top-level LICENSE file for more information\n */\n\nimport {staticAsset} from 'utils/functions';\n\n// Constants defining Bootstrap Breakpoints\nexport const BREAKPOINT_SM = 768;\nexport const BREAKPOINT_MD = 992;\nexport const BREAKPOINT_LG = 1200;\n\nexport const swhSpinnerSrc = staticAsset('img/swh-spinner.gif');\n","/**\n * Copyright (C) 2018-2020  The Software Heritage developers\n * See the AUTHORS file at the top-level directory of this distribution\n * License: GNU Affero General Public License version 3, or any later version\n * See top-level LICENSE file for more information\n */\n\n// utility functions\n\nexport function handleFetchError(response) {\n  if (!response.ok) {\n    throw response;\n  }\n  return response;\n}\n\nexport function handleFetchErrors(responses) {\n  for (let i = 0; i < responses.length; ++i) {\n    if (!responses[i].ok) {\n      throw responses[i];\n    }\n  }\n  return responses;\n}\n\nexport function staticAsset(asset) {\n  return `${__STATIC__}${asset}`;\n}\n\nexport function csrfPost(url, headers = {}, body = null) {\n  headers['X-CSRFToken'] = Cookies.get('csrftoken');\n  return fetch(url, {\n    credentials: 'include',\n    headers: headers,\n    method: 'POST',\n    body: body\n  });\n}\n\nexport function isGitRepoUrl(url, pathPrefix = '/') {\n  let allowedProtocols = ['http:', 'https:', 'git:'];\n  if (allowedProtocols.find(protocol => protocol === url.protocol) === undefined) {\n    return false;\n  }\n  if (!url.pathname.startsWith(pathPrefix)) {\n    return false;\n  }\n  let re = new RegExp('[\\\\w\\\\.-]+\\\\/?(?!=.git)(?:\\\\.git\\\\/?)?$');\n  return re.test(url.pathname.slice(pathPrefix.length));\n};\n\nexport function removeUrlFragment() {\n  history.replaceState('', document.title, window.location.pathname + window.location.search);\n}\n\nexport function selectText(startNode, endNode) {\n  let selection = window.getSelection();\n  selection.removeAllRanges();\n  let range = document.createRange();\n  range.setStart(startNode, 0);\n  if (endNode.nodeName !== '#text') {\n    range.setEnd(endNode, endNode.childNodes.length);\n  } else {\n    range.setEnd(endNode, endNode.textContent.length);\n  }\n  selection.addRange(range);\n}\n\nexport function htmlAlert(type, message, closable = false) {\n  let closeButton = '';\n  let extraClasses = '';\n  if (closable) {\n    closeButton =\n      `<button type=\"button\" class=\"close\" data-dismiss=\"alert\" aria-label=\"Close\">\n        <span aria-hidden=\"true\">&times;</span>\n      </button>`;\n    extraClasses = 'alert-dismissible';\n  }\n  return `<div class=\"alert alert-${type} ${extraClasses}\" role=\"alert\">${message}${closeButton}</div>`;\n}\n","module.exports = function anonymous(locals, escapeFn, include, rethrow\n) {\nescapeFn = escapeFn || function (markup) {\n  return markup == undefined\n    ? ''\n    : String(markup)\n      .replace(_MATCH_HTML, encode_char);\n};\nvar _ENCODE_HTML_RULES = {\n      \"&\": \"&amp;\"\n    , \"<\": \"&lt;\"\n    , \">\": \"&gt;\"\n    , '\"': \"&#34;\"\n    , \"'\": \"&#39;\"\n    }\n  , _MATCH_HTML = /[&<>'\"]/g;\nfunction encode_char(c) {\n  return _ENCODE_HTML_RULES[c] || c;\n};\n;\n  var __output = \"\";\n  function __append(s) { if (s !== undefined && s !== null) __output += s }\n  with (locals || {}) {\n    ; __append(\"\\n\\n<div class=\\\"swh-save-origin-archives-form swh-save-origin-artifact-form form-row\\\">\\n  <div class=\\\"form-group col-md-7\\\">\\n    <label for=\\\"swh-input-artifact-url-\")\n    ; __append(escapeFn( formId ))\n    ; __append(\"\\\">Artifact url</label>\\n    <input type=\\\"text\\\" class=\\\"form-control\\\" id=\\\"swh-input-artifact-url-\")\n    ; __append(escapeFn( formId ))\n    ; __append(\"\\\" required>\\n    <div class=\\\"invalid-feedback\\\">The artifact url is mandatory</div>\\n  </div>\\n  <div class=\\\"form-group col-md-2\\\">\\n    <label for=\\\"swh-input-artifact-version-\")\n    ; __append(escapeFn( formId ))\n    ; __append(\"\\\">Artifact version</label>\\n    <input type=\\\"text\\\" class=\\\"form-control\\\" id=\\\"swh-input-artifact-version-\")\n    ; __append(escapeFn( formId ))\n    ; __append(\"\\\" required>\\n    <div class=\\\"invalid-feedback\\\">The artifact version is mandatory</div>\\n  </div>\\n  <div class=\\\"col-md-2\\\">\\n    \")\n    ;  if (deletableRow) { \n    ; __append(\"\\n      <label for=\\\"swh-remove-archive-artifact-\")\n    ; __append(escapeFn( formId ))\n    ; __append(\"\\\">&nbsp;</label>\\n      <button id=\\\"swh-remove-archive-artifact-\")\n    ; __append(escapeFn( formId ))\n    ; __append(\"\\\" type=\\\"button\\\" class=\\\"btn btn-default btn-block\\\" onclick=\\\"swh.save.deleteArtifactFormRow(event)\\\">\\n              <i class=\\\"mdi mdi-file-remove mdi-fw\\\" aria-hidden=\\\"true\\\"></i>Remove artifact\\n      </button>\\n    \")\n    ;  } else { \n    ; __append(\"\\n      <label for=\\\"swh-add-archive-artifact\\\">&nbsp;</label>\\n      <button id=\\\"swh-add-archive-artifact\\\" type=\\\"button\\\" class=\\\"btn btn-default btn-block\\\" onclick=\\\"swh.save.addArtifactFormRow()\\\">\\n        <i class=\\\"mdi mdi-file-plus mdi-fw\\\" aria-hidden=\\\"true\\\"></i>Add artifact\\n      </button>\\n    \")\n    ;  } \n    ; __append(\"\\n  </div>\\n</div>\")\n  }\n  return __output;\n\n}","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = function(module) {\n\tvar getter = module && module.__esModule ?\n\t\tfunction() { return module['default']; } :\n\t\tfunction() { return module; };\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = function(exports, definition) {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = function(obj, prop) { return Object.prototype.hasOwnProperty.call(obj, prop); }","// define __esModule on exports\n__webpack_require__.r = function(exports) {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","/**\n * Copyright (C) 2018-2021  The Software Heritage developers\n * See the AUTHORS file at the top-level directory of this distribution\n * License: GNU Affero General Public License version 3, or any later version\n * See top-level LICENSE file for more information\n */\n\nimport {csrfPost, handleFetchError, isGitRepoUrl, htmlAlert, removeUrlFragment} from 'utils/functions';\nimport {swhSpinnerSrc} from 'utils/constants';\nimport artifactFormRowTemplate from './artifact-form-row.ejs';\n\nlet saveRequestsTable;\n\nfunction originSaveRequest(\n  originType, originUrl, extraData,\n  acceptedCallback, pendingCallback, errorCallback\n) {\n  // Actually trigger the origin save request\n  let addSaveOriginRequestUrl = Urls.api_1_save_origin(originType, originUrl);\n  $('.swh-processing-save-request').css('display', 'block');\n  let headers = {};\n  let body = null;\n  if (extraData !== {}) {\n    body = JSON.stringify(extraData);\n    headers = {\n      'Content-Type': 'application/json'\n    };\n  };\n\n  csrfPost(addSaveOriginRequestUrl, headers, body)\n    .then(handleFetchError)\n    .then(response => response.json())\n    .then(data => {\n      $('.swh-processing-save-request').css('display', 'none');\n      if (data.save_request_status === 'accepted') {\n        acceptedCallback();\n      } else {\n        pendingCallback();\n      }\n    })\n    .catch(response => {\n      $('.swh-processing-save-request').css('display', 'none');\n      response.json().then(errorData => {\n        errorCallback(response.status, errorData);\n      });\n    });\n}\n\nfunction addArtifactVersionAutofillHandler(formId) {\n  // autofill artifact version input with the filename from\n  // the artifact url without extensions\n  $(`#swh-input-artifact-url-${formId}`).on('input', function(event) {\n    const artifactUrl = $(this).val().trim();\n    let filename = artifactUrl.split('/').slice(-1)[0];\n    if (filename !== artifactUrl) {\n      filename = filename.replace(/tar.*$/, 'tar');\n      const filenameNoExt = filename.split('.').slice(0, -1).join('.');\n      const artifactVersion = $(`#swh-input-artifact-version-${formId}`);\n      if (filenameNoExt !== filename) {\n        artifactVersion.val(filenameNoExt);\n      }\n    }\n  });\n}\n\nexport function maybeRequireExtraInputs() {\n  // Read the actual selected value and depending on the origin type, display some extra\n  // inputs or hide them. This makes the extra inputs disabled when not displayed.\n  const originType = $('#swh-input-visit-type').val();\n  let display = 'none';\n  let disabled = true;\n\n  if (originType === 'archives') {\n    display = 'flex';\n    disabled = false;\n  }\n  $('.swh-save-origin-archives-form').css('display', display);\n  if (!disabled) {\n    // help paragraph must have block display for proper rendering\n    $('#swh-save-origin-archives-help').css('display', 'block');\n  }\n  $('.swh-save-origin-archives-form .form-control').prop('disabled', disabled);\n\n  if (originType === 'archives' && $('.swh-save-origin-archives-form').length === 1) {\n    // insert first artifact row when the archives visit type is selected for the first time\n    $('.swh-save-origin-archives-form').last().after(\n      artifactFormRowTemplate({deletableRow: false, formId: 0}));\n    addArtifactVersionAutofillHandler(0);\n  }\n}\n\nexport function addArtifactFormRow() {\n  const formId = $('.swh-save-origin-artifact-form').length;\n  $('.swh-save-origin-artifact-form').last().after(\n    artifactFormRowTemplate({\n      deletableRow: true,\n      formId: formId\n    })\n  );\n  addArtifactVersionAutofillHandler(formId);\n}\n\nexport function deleteArtifactFormRow(event) {\n  $(event.target).closest('.swh-save-origin-artifact-form').remove();\n}\n\nconst userRequestsFilterCheckbox = `\n<div class=\"custom-control custom-checkbox swhid-option\">\n  <input class=\"custom-control-input\" value=\"option-user-requests-filter\" type=\"checkbox\"\n         id=\"swh-save-requests-user-filter\">\n  <label class=\"custom-control-label font-weight-normal\" for=\"swh-save-requests-user-filter\">\n    show only your own requests\n  </label>\n</div>\n`;\n\nexport function initOriginSave() {\n\n  $(document).ready(() => {\n\n    $.fn.dataTable.ext.errMode = 'none';\n\n    fetch(Urls.origin_save_types_list())\n      .then(response => response.json())\n      .then(data => {\n        for (let originType of data) {\n          $('#swh-input-visit-type').append(`<option value=\"${originType}\">${originType}</option>`);\n        }\n        // set git as the default value as before\n        $('#swh-input-visit-type').val('git');\n      });\n\n    saveRequestsTable = $('#swh-origin-save-requests')\n      .on('error.dt', (e, settings, techNote, message) => {\n        $('#swh-origin-save-request-list-error').text('An error occurred while retrieving the save requests list');\n        console.log(message);\n      })\n      .DataTable({\n        serverSide: true,\n        processing: true,\n        language: {\n          processing: `<img src=\"${swhSpinnerSrc}\"></img>`\n        },\n        ajax: {\n          url: Urls.origin_save_requests_list('all'),\n          data: (d) => {\n            if (swh.webapp.isUserLoggedIn() && $('#swh-save-requests-user-filter').prop('checked')) {\n              d.user_requests_only = '1';\n            }\n          }\n        },\n        searchDelay: 1000,\n        // see https://datatables.net/examples/advanced_init/dom_toolbar.html and the comments section\n        // this option customizes datatables UI components by adding an extra checkbox above the table\n        // while keeping bootstrap layout\n        dom: '<\"row\"<\"col-sm-3\"l><\"col-sm-6 text-left user-requests-filter\"><\"col-sm-3\"f>>' +\n             '<\"row\"<\"col-sm-12\"tr>>' +\n             '<\"row\"<\"col-sm-5\"i><\"col-sm-7\"p>>',\n        fnInitComplete: function() {\n          if (swh.webapp.isUserLoggedIn()) {\n            $('div.user-requests-filter').html(userRequestsFilterCheckbox);\n            $('#swh-save-requests-user-filter').on('change', () => {\n              saveRequestsTable.draw();\n            });\n          }\n        },\n        columns: [\n          {\n            data: 'save_request_date',\n            name: 'request_date',\n            render: (data, type, row) => {\n              if (type === 'display') {\n                let date = new Date(data);\n                return date.toLocaleString();\n              }\n              return data;\n            }\n          },\n          {\n            data: 'visit_type',\n            name: 'visit_type'\n          },\n          {\n            data: 'origin_url',\n            name: 'origin_url',\n            render: (data, type, row) => {\n              if (type === 'display') {\n                let html = '';\n                const sanitizedURL = $.fn.dataTable.render.text().display(data);\n                if (row.save_task_status === 'succeeded') {\n                  let browseOriginUrl = `${Urls.browse_origin()}?origin_url=${encodeURIComponent(sanitizedURL)}`;\n                  if (row.visit_date) {\n                    browseOriginUrl += `&amp;timestamp=${encodeURIComponent(row.visit_date)}`;\n                  }\n                  html += `<a href=\"${browseOriginUrl}\">${sanitizedURL}</a>`;\n                } else {\n                  html += sanitizedURL;\n                }\n                html += `&nbsp;<a href=\"${sanitizedURL}\"><i class=\"mdi mdi-open-in-new\" aria-hidden=\"true\"></i></a>`;\n                return html;\n              }\n              return data;\n            }\n          },\n          {\n            data: 'save_request_status',\n            name: 'status'\n          },\n          {\n            data: 'save_task_status',\n            name: 'loading_task_status'\n          },\n          {\n            name: 'info',\n            render: (data, type, row) => {\n              if (row.save_task_status === 'succeeded' || row.save_task_status === 'failed') {\n                return `<i class=\"mdi mdi-information-outline swh-save-request-info\" ` +\n                       'aria-hidden=\"true\" style=\"cursor: pointer\"' +\n                       `onclick=\"swh.save.displaySaveRequestInfo(event, ${row.id})\"></i>`;\n              } else {\n                return '';\n              }\n            }\n          },\n          {\n            render: (data, type, row) => {\n              if (row.save_request_status === 'accepted') {\n                const saveAgainButton =\n                  '<button class=\"btn btn-default btn-sm swh-save-origin-again\" type=\"button\" ' +\n                  `onclick=\"swh.save.fillSaveRequestFormAndScroll(` +\n                  `'${row.visit_type}', '${row.origin_url}');\">` +\n                  '<i class=\"mdi mdi-camera mdi-fw\" aria-hidden=\"true\"></i>' +\n                  'Save again</button>';\n                return saveAgainButton;\n              } else {\n                return '';\n              }\n            }\n          }\n        ],\n        scrollY: '50vh',\n        scrollCollapse: true,\n        order: [[0, 'desc']],\n        responsive: {\n          details: {\n            type: 'none'\n          }\n        }\n      });\n\n    swh.webapp.addJumpToPagePopoverToDataTable(saveRequestsTable);\n\n    $('#swh-origin-save-requests-list-tab').on('shown.bs.tab', () => {\n      saveRequestsTable.draw();\n      window.location.hash = '#requests';\n    });\n\n    $('#swh-origin-save-request-help-tab').on('shown.bs.tab', () => {\n      removeUrlFragment();\n      $('.swh-save-request-info').popover('dispose');\n    });\n\n    let saveRequestAcceptedAlert = htmlAlert(\n      'success',\n      'The \"save code now\" request has been accepted and will be processed as soon as possible.',\n      true\n    );\n\n    let saveRequestPendingAlert = htmlAlert(\n      'warning',\n      'The \"save code now\" request has been put in pending state and may be accepted for processing after manual review.',\n      true\n    );\n\n    let saveRequestRateLimitedAlert = htmlAlert(\n      'danger',\n      'The rate limit for \"save code now\" requests has been reached. Please try again later.',\n      true\n    );\n\n    let saveRequestUnknownErrorAlert = htmlAlert(\n      'danger',\n      'An unexpected error happened when submitting the \"save code now request\".',\n      true\n    );\n\n    $('#swh-save-origin-form').submit(event => {\n      event.preventDefault();\n      event.stopPropagation();\n      $('.alert').alert('close');\n      if (event.target.checkValidity()) {\n        $(event.target).removeClass('was-validated');\n        let originType = $('#swh-input-visit-type').val();\n        let originUrl = $('#swh-input-origin-url').val();\n\n        // read the extra inputs for the 'archives' type\n        let extraData = {};\n        if (originType === 'archives') {\n          extraData['archives_data'] = [];\n          for (let i = 0; i < $('.swh-save-origin-artifact-form').length; ++i) {\n            extraData['archives_data'].push({\n              'artifact_url': $(`#swh-input-artifact-url-${i}`).val(),\n              'artifact_version': $(`#swh-input-artifact-version-${i}`).val()\n            });\n          }\n        }\n\n        originSaveRequest(originType, originUrl, extraData,\n                          () => $('#swh-origin-save-request-status').html(saveRequestAcceptedAlert),\n                          () => $('#swh-origin-save-request-status').html(saveRequestPendingAlert),\n                          (statusCode, errorData) => {\n                            $('#swh-origin-save-request-status').css('color', 'red');\n                            if (statusCode === 403) {\n                              const errorAlert = htmlAlert('danger', `Error: ${errorData['reason']}`);\n                              $('#swh-origin-save-request-status').html(errorAlert);\n                            } else if (statusCode === 429) {\n                              $('#swh-origin-save-request-status').html(saveRequestRateLimitedAlert);\n                            } else if (statusCode === 400) {\n                              const errorAlert = htmlAlert('danger', errorData['reason']);\n                              $('#swh-origin-save-request-status').html(errorAlert);\n                            } else {\n                              $('#swh-origin-save-request-status').html(saveRequestUnknownErrorAlert);\n                            }\n                          });\n      } else {\n        $(event.target).addClass('was-validated');\n      }\n    });\n\n    $('#swh-show-origin-save-requests-list').on('click', (event) => {\n      event.preventDefault();\n      $('.nav-tabs a[href=\"#swh-origin-save-requests-list\"]').tab('show');\n    });\n\n    $('#swh-input-origin-url').on('input', function(event) {\n      let originUrl = $(this).val().trim();\n      $(this).val(originUrl);\n      $('#swh-input-visit-type option').each(function() {\n        let val = $(this).val();\n        if (val && originUrl.includes(val)) {\n          $(this).prop('selected', true);\n        }\n      });\n    });\n\n    if (window.location.hash === '#requests') {\n      $('.nav-tabs a[href=\"#swh-origin-save-requests-list\"]').tab('show');\n    }\n\n  });\n\n}\n\nexport function validateSaveOriginUrl(input) {\n  let originType = $('#swh-input-visit-type').val();\n  let originUrl = null;\n  let validUrl = true;\n\n  try {\n    originUrl = new URL(input.value.trim());\n  } catch (TypeError) {\n    validUrl = false;\n  }\n\n  if (validUrl) {\n    let allowedProtocols = ['http:', 'https:', 'svn:', 'git:'];\n    validUrl = (\n      allowedProtocols.find(protocol => protocol === originUrl.protocol) !== undefined\n    );\n  }\n\n  if (validUrl && originType === 'git') {\n    // additional checks for well known code hosting providers\n    switch (originUrl.hostname) {\n      case 'github.com':\n        validUrl = isGitRepoUrl(originUrl);\n        break;\n\n      case 'git.code.sf.net':\n        validUrl = isGitRepoUrl(originUrl, '/p/');\n        break;\n\n      case 'bitbucket.org':\n        validUrl = isGitRepoUrl(originUrl);\n        break;\n\n      default:\n        if (originUrl.hostname.startsWith('gitlab.')) {\n          validUrl = isGitRepoUrl(originUrl);\n        }\n        break;\n    }\n  }\n\n  if (validUrl) {\n    input.setCustomValidity('');\n  } else {\n    input.setCustomValidity('The origin url is not valid or does not reference a code repository');\n  }\n}\n\nexport function initTakeNewSnapshot() {\n\n  let newSnapshotRequestAcceptedAlert = htmlAlert(\n    'success',\n    'The \"take new snapshot\" request has been accepted and will be processed as soon as possible.',\n    true\n  );\n\n  let newSnapshotRequestPendingAlert = htmlAlert(\n    'warning',\n    'The \"take new snapshot\" request has been put in pending state and may be accepted for processing after manual review.',\n    true\n  );\n\n  let newSnapshotRequestRateLimitAlert = htmlAlert(\n    'danger',\n    'The rate limit for \"take new snapshot\" requests has been reached. Please try again later.',\n    true\n  );\n\n  let newSnapshotRequestUnknownErrorAlert = htmlAlert(\n    'danger',\n    'An unexpected error happened when submitting the \"save code now request\".',\n    true\n  );\n\n  $(document).ready(() => {\n    $('#swh-take-new-snapshot-form').submit(event => {\n      event.preventDefault();\n      event.stopPropagation();\n\n      let originType = $('#swh-input-visit-type').val();\n      let originUrl = $('#swh-input-origin-url').val();\n      let extraData = {};\n\n      originSaveRequest(originType, originUrl, extraData,\n                        () => $('#swh-take-new-snapshot-request-status').html(newSnapshotRequestAcceptedAlert),\n                        () => $('#swh-take-new-snapshot-request-status').html(newSnapshotRequestPendingAlert),\n                        (statusCode, errorData) => {\n                          $('#swh-take-new-snapshot-request-status').css('color', 'red');\n                          if (statusCode === 403) {\n                            const errorAlert = htmlAlert('danger', `Error: ${errorData['detail']}`, true);\n                            $('#swh-take-new-snapshot-request-status').html(errorAlert);\n                          } else if (statusCode === 429) {\n                            $('#swh-take-new-snapshot-request-status').html(newSnapshotRequestRateLimitAlert);\n                          } else {\n                            $('#swh-take-new-snapshot-request-status').html(newSnapshotRequestUnknownErrorAlert);\n                          }\n                        });\n    });\n  });\n}\n\nexport function formatValuePerType(type, value) {\n  // Given some typed value, format and return accordingly formatted value\n  const mapFormatPerTypeFn = {\n    'json': (v) => JSON.stringify(v, null, 2),\n    'date': (v) => new Date(v).toLocaleString(),\n    'raw': (v) => v,\n    'duration': (v) => v + ' seconds'\n  };\n\n  return value === null ? null : mapFormatPerTypeFn[type](value);\n}\n\nexport function displaySaveRequestInfo(event, saveRequestId) {\n  event.stopPropagation();\n  const saveRequestTaskInfoUrl = Urls.origin_save_task_info(saveRequestId);\n  // close popover when clicking again on the info icon\n  if ($(event.target).data('bs.popover')) {\n    $(event.target).popover('dispose');\n    return;\n  }\n  $('.swh-save-request-info').popover('dispose');\n  $(event.target).popover({\n    animation: false,\n    boundary: 'viewport',\n    container: 'body',\n    title: 'Save request task information ' +\n             '<i style=\"cursor: pointer; position: absolute; right: 1rem;\" ' +\n             `class=\"mdi mdi-close swh-save-request-info-close\"></i>`,\n    content: `<div class=\"swh-popover swh-save-request-info-popover\">\n                  <div class=\"text-center\">\n                    <img src=${swhSpinnerSrc}></img>\n                    <p>Fetching task information ...</p>\n                  </div>\n                </div>`,\n    html: true,\n    placement: 'left',\n    sanitizeFn: swh.webapp.filterXSS\n  });\n\n  $(event.target).on('shown.bs.popover', function() {\n    const popoverId = $(this).attr('aria-describedby');\n    $(`#${popoverId} .mdi-close`).click(() => {\n      $(this).popover('dispose');\n    });\n  });\n\n  $(event.target).popover('show');\n  fetch(saveRequestTaskInfoUrl)\n    .then(response => response.json())\n    .then(saveRequestTaskInfo => {\n      let content;\n      if ($.isEmptyObject(saveRequestTaskInfo)) {\n        content = 'Not available';\n      } else {\n        let saveRequestInfo = [];\n        const taskData = {\n          'Type': ['raw', 'type'],\n          'Visit status': ['raw', 'visit_status'],\n          'Arguments': ['json', 'arguments'],\n          'Id': ['raw', 'id'],\n          'Backend id': ['raw', 'backend_id'],\n          'Scheduling date': ['date', 'scheduled'],\n          'Start date': ['date', 'started'],\n          'Completion date': ['date', 'ended'],\n          'Duration': ['duration', 'duration'],\n          'Runner': ['raw', 'worker'],\n          'Log': ['raw', 'message']\n        };\n        for (const [title, [type, property]] of Object.entries(taskData)) {\n          if (saveRequestTaskInfo.hasOwnProperty(property)) {\n            saveRequestInfo.push({\n              key: title,\n              value: formatValuePerType(type, saveRequestTaskInfo[property])\n            });\n          }\n        }\n        content = '<table class=\"table\"><tbody>';\n        for (let info of saveRequestInfo) {\n          content +=\n            `<tr>\n              <th class=\"swh-metadata-table-row swh-metadata-table-key\">${info.key}</th>\n              <td class=\"swh-metadata-table-row swh-metadata-table-value\">\n                <pre>${info.value}</pre>\n              </td>\n            </tr>`;\n        }\n        content += '</tbody></table>';\n      }\n      $('.swh-popover').html(content);\n      $(event.target).popover('update');\n    });\n}\n\nexport function fillSaveRequestFormAndScroll(visitType, originUrl) {\n  $('#swh-input-origin-url').val(originUrl);\n  let originTypeFound = false;\n  $('#swh-input-visit-type option').each(function() {\n    let val = $(this).val();\n    if (val && originUrl.includes(val)) {\n      $(this).prop('selected', true);\n      originTypeFound = true;\n    }\n  });\n  if (!originTypeFound) {\n    $('#swh-input-visit-type option').each(function() {\n      let val = $(this).val();\n      if (val === visitType) {\n        $(this).prop('selected', true);\n      }\n    });\n  }\n  window.scrollTo(0, 0);\n}\n"],"sourceRoot":""}