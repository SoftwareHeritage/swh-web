{"version":3,"sources":["webpack://swh.save/webpack/universalModuleDefinition","webpack://swh.save/./swh/web/assets/src/bundles/save/index.js","webpack://swh.save/./swh/web/assets/src/utils/constants.js","webpack://swh.save/./swh/web/assets/src/utils/functions.js","webpack://swh.save/webpack/bootstrap","webpack://swh.save/webpack/startup","webpack://swh.save/webpack/runtime/define property getters","webpack://swh.save/webpack/runtime/hasOwnProperty shorthand","webpack://swh.save/webpack/runtime/make namespace object"],"names":["root","factory","exports","module","define","amd","self","saveRequestsTable","originSaveRequest","originType","originUrl","acceptedCallback","pendingCallback","errorCallback","addSaveOriginRequestUrl","Urls","origin_save_request","$","css","csrfPost","then","handleFetchError","response","json","data","save_request_status","errorData","status","initOriginSave","document","ready","fn","dataTable","ext","errMode","fetch","origin_save_types_list","append","on","e","settings","techNote","message","text","console","log","DataTable","serverSide","processing","language","swhSpinnerSrc","ajax","origin_save_requests_list","searchDelay","columns","name","render","type","row","Date","toLocaleString","html","sanitizedURL","display","save_task_status","browseOriginUrl","browse_origin","encodeURIComponent","visit_date","id","visit_type","origin_url","scrollY","scrollCollapse","order","responsive","details","swh","webapp","addJumpToPagePopoverToDataTable","draw","window","location","hash","removeUrlFragment","popover","saveRequestAcceptedAlert","htmlAlert","saveRequestPendingAlert","saveRequestRateLimitedAlert","saveRequestUnknownErrorAlert","submit","event","preventDefault","stopPropagation","alert","target","checkValidity","removeClass","val","statusCode","errorAlert","addClass","tab","this","trim","each","includes","prop","validateSaveOriginUrl","input","validUrl","URL","value","TypeError","undefined","find","protocol","hostname","isGitRepoUrl","startsWith","setCustomValidity","initTakeNewSnapshot","newSnapshotRequestAcceptedAlert","newSnapshotRequestPendingAlert","newSnapshotRequestRateLimitAlert","newSnapshotRequestUnknownErrorAlert","displaySaveRequestInfo","saveRequestId","saveRequestTaskInfoUrl","origin_save_task_info","animation","boundary","container","title","content","placement","sanitizeFn","filterXSS","popoverId","attr","click","saveRequestTaskInfo","isEmptyObject","saveRequestInfo","push","key","arguments","JSON","stringify","backend_id","scheduled","started","ended","duration","worker","info","fillSaveRequestFormAndScroll","visitType","originTypeFound","scrollTo","staticAsset","ok","asset","__STATIC__","url","headers","body","Cookies","get","credentials","method","pathPrefix","pathname","RegExp","test","slice","length","history","replaceState","search","closable","closeButton","extraClasses","__webpack_module_cache__","__webpack_require__","moduleId","__webpack_modules__","d","definition","o","Object","defineProperty","enumerable","obj","prototype","hasOwnProperty","call","r","Symbol","toStringTag"],"mappings":"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","file":"js/save.4ce74bd22988f6b2b48e.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"swh\"] = factory();\n\telse\n\t\troot[\"swh\"] = root[\"swh\"] || {}, root[\"swh\"][\"save\"] = factory();\n})(self, function() {\nreturn ","/**\n * Copyright (C) 2018-2020  The Software Heritage developers\n * See the AUTHORS file at the top-level directory of this distribution\n * License: GNU Affero General Public License version 3, or any later version\n * See top-level LICENSE file for more information\n */\n\nimport {handleFetchError, csrfPost, isGitRepoUrl, htmlAlert, removeUrlFragment} from 'utils/functions';\nimport {swhSpinnerSrc} from 'utils/constants';\n\nlet saveRequestsTable;\n\nfunction originSaveRequest(originType, originUrl,\n                           acceptedCallback, pendingCallback, errorCallback) {\n  let addSaveOriginRequestUrl = Urls.origin_save_request(originType, originUrl);\n  let headers = {\n    'Accept': 'application/json',\n    'Content-Type': 'application/json'\n  };\n  $('.swh-processing-save-request').css('display', 'block');\n  csrfPost(addSaveOriginRequestUrl, headers)\n    .then(handleFetchError)\n    .then(response => response.json())\n    .then(data => {\n      $('.swh-processing-save-request').css('display', 'none');\n      if (data.save_request_status === 'accepted') {\n        acceptedCallback();\n      } else {\n        pendingCallback();\n      }\n    })\n    .catch(response => {\n      $('.swh-processing-save-request').css('display', 'none');\n      response.json().then(errorData => {\n        errorCallback(response.status, errorData);\n      });\n    });\n}\n\nexport function initOriginSave() {\n\n  $(document).ready(() => {\n\n    $.fn.dataTable.ext.errMode = 'none';\n\n    fetch(Urls.origin_save_types_list())\n      .then(response => response.json())\n      .then(data => {\n        for (let originType of data) {\n          $('#swh-input-visit-type').append(`<option value=\"${originType}\">${originType}</option>`);\n        }\n      });\n\n    saveRequestsTable = $('#swh-origin-save-requests')\n      .on('error.dt', (e, settings, techNote, message) => {\n        $('#swh-origin-save-request-list-error').text('An error occurred while retrieving the save requests list');\n        console.log(message);\n      })\n      .DataTable({\n        serverSide: true,\n        processing: true,\n        language: {\n          processing: `<img src=\"${swhSpinnerSrc}\"></img>`\n        },\n        ajax: Urls.origin_save_requests_list('all'),\n        searchDelay: 1000,\n        columns: [\n          {\n            data: 'save_request_date',\n            name: 'request_date',\n            render: (data, type, row) => {\n              if (type === 'display') {\n                let date = new Date(data);\n                return date.toLocaleString();\n              }\n              return data;\n            }\n          },\n          {\n            data: 'visit_type',\n            name: 'visit_type'\n          },\n          {\n            data: 'origin_url',\n            name: 'origin_url',\n            render: (data, type, row) => {\n              if (type === 'display') {\n                let html = '';\n                const sanitizedURL = $.fn.dataTable.render.text().display(data);\n                if (row.save_task_status === 'succeeded') {\n                  let browseOriginUrl = `${Urls.browse_origin()}?origin_url=${encodeURIComponent(sanitizedURL)}`;\n                  if (row.visit_date) {\n                    browseOriginUrl += `&amp;timestamp=${encodeURIComponent(row.visit_date)}`;\n                  }\n                  html += `<a href=\"${browseOriginUrl}\">${sanitizedURL}</a>`;\n                } else {\n                  html += sanitizedURL;\n                }\n                html += `&nbsp;<a href=\"${sanitizedURL}\"><i class=\"mdi mdi-open-in-new\" aria-hidden=\"true\"></i></a>`;\n                return html;\n              }\n              return data;\n            }\n          },\n          {\n            data: 'save_request_status',\n            name: 'status'\n          },\n          {\n            data: 'save_task_status',\n            name: 'loading_task_status'\n          },\n          {\n            name: 'info',\n            render: (data, type, row) => {\n              if (row.save_task_status === 'succeeded' || row.save_task_status === 'failed') {\n                return `<i class=\"mdi mdi-information-outline swh-save-request-info\" ` +\n                       'aria-hidden=\"true\" style=\"cursor: pointer\"' +\n                       `onclick=\"swh.save.displaySaveRequestInfo(event, ${row.id})\"></i>`;\n              } else {\n                return '';\n              }\n            }\n          },\n          {\n            render: (data, type, row) => {\n              if (row.save_request_status === 'accepted') {\n                const saveAgainButton =\n                  '<button class=\"btn btn-default btn-sm swh-save-origin-again\" type=\"button\" ' +\n                  `onclick=\"swh.save.fillSaveRequestFormAndScroll(` +\n                  `'${row.visit_type}', '${row.origin_url}');\">` +\n                  '<i class=\"mdi mdi-camera mdi-fw\" aria-hidden=\"true\"></i>' +\n                  'Save again</button>';\n                return saveAgainButton;\n              } else {\n                return '';\n              }\n            }\n          }\n        ],\n        scrollY: '50vh',\n        scrollCollapse: true,\n        order: [[0, 'desc']],\n        responsive: {\n          details: {\n            type: 'none'\n          }\n        }\n      });\n\n    swh.webapp.addJumpToPagePopoverToDataTable(saveRequestsTable);\n\n    $('#swh-origin-save-requests-list-tab').on('shown.bs.tab', () => {\n      saveRequestsTable.draw();\n      window.location.hash = '#requests';\n    });\n\n    $('#swh-origin-save-request-help-tab').on('shown.bs.tab', () => {\n      removeUrlFragment();\n      $('.swh-save-request-info').popover('dispose');\n    });\n\n    let saveRequestAcceptedAlert = htmlAlert(\n      'success',\n      'The \"save code now\" request has been accepted and will be processed as soon as possible.',\n      true\n    );\n\n    let saveRequestPendingAlert = htmlAlert(\n      'warning',\n      'The \"save code now\" request has been put in pending state and may be accepted for processing after manual review.',\n      true\n    );\n\n    let saveRequestRateLimitedAlert = htmlAlert(\n      'danger',\n      'The rate limit for \"save code now\" requests has been reached. Please try again later.',\n      true\n    );\n\n    let saveRequestUnknownErrorAlert = htmlAlert(\n      'danger',\n      'An unexpected error happened when submitting the \"save code now request\".',\n      true\n    );\n\n    $('#swh-save-origin-form').submit(event => {\n      event.preventDefault();\n      event.stopPropagation();\n      $('.alert').alert('close');\n      if (event.target.checkValidity()) {\n        $(event.target).removeClass('was-validated');\n        let originType = $('#swh-input-visit-type').val();\n        let originUrl = $('#swh-input-origin-url').val();\n\n        originSaveRequest(originType, originUrl,\n                          () => $('#swh-origin-save-request-status').html(saveRequestAcceptedAlert),\n                          () => $('#swh-origin-save-request-status').html(saveRequestPendingAlert),\n                          (statusCode, errorData) => {\n                            $('#swh-origin-save-request-status').css('color', 'red');\n                            if (statusCode === 403) {\n                              const errorAlert = htmlAlert('danger', `Error: ${errorData['detail']}`);\n                              $('#swh-origin-save-request-status').html(errorAlert);\n                            } else if (statusCode === 429) {\n                              $('#swh-origin-save-request-status').html(saveRequestRateLimitedAlert);\n                            } else {\n                              $('#swh-origin-save-request-status').html(saveRequestUnknownErrorAlert);\n                            }\n                          });\n      } else {\n        $(event.target).addClass('was-validated');\n      }\n    });\n\n    $('#swh-show-origin-save-requests-list').on('click', (event) => {\n      event.preventDefault();\n      $('.nav-tabs a[href=\"#swh-origin-save-requests-list\"]').tab('show');\n    });\n\n    $('#swh-input-origin-url').on('input', function(event) {\n      let originUrl = $(this).val().trim();\n      $(this).val(originUrl);\n      $('#swh-input-visit-type option').each(function() {\n        let val = $(this).val();\n        if (val && originUrl.includes(val)) {\n          $(this).prop('selected', true);\n        }\n      });\n    });\n\n    if (window.location.hash === '#requests') {\n      $('.nav-tabs a[href=\"#swh-origin-save-requests-list\"]').tab('show');\n    }\n\n  });\n\n}\n\nexport function validateSaveOriginUrl(input) {\n  let originType = $('#swh-input-visit-type').val();\n  let originUrl = null;\n  let validUrl = true;\n\n  try {\n    originUrl = new URL(input.value.trim());\n  } catch (TypeError) {\n    validUrl = false;\n  }\n\n  if (validUrl) {\n    let allowedProtocols = ['http:', 'https:', 'svn:', 'git:'];\n    validUrl = (\n      allowedProtocols.find(protocol => protocol === originUrl.protocol) !== undefined\n    );\n  }\n\n  if (validUrl && originType === 'git') {\n    // additional checks for well known code hosting providers\n    switch (originUrl.hostname) {\n      case 'github.com':\n        validUrl = isGitRepoUrl(originUrl);\n        break;\n\n      case 'git.code.sf.net':\n        validUrl = isGitRepoUrl(originUrl, '/p/');\n        break;\n\n      case 'bitbucket.org':\n        validUrl = isGitRepoUrl(originUrl);\n        break;\n\n      default:\n        if (originUrl.hostname.startsWith('gitlab.')) {\n          validUrl = isGitRepoUrl(originUrl);\n        }\n        break;\n    }\n  }\n\n  if (validUrl) {\n    input.setCustomValidity('');\n  } else {\n    input.setCustomValidity('The origin url is not valid or does not reference a code repository');\n  }\n}\n\nexport function initTakeNewSnapshot() {\n\n  let newSnapshotRequestAcceptedAlert = htmlAlert(\n    'success',\n    'The \"take new snapshot\" request has been accepted and will be processed as soon as possible.',\n    true\n  );\n\n  let newSnapshotRequestPendingAlert = htmlAlert(\n    'warning',\n    'The \"take new snapshot\" request has been put in pending state and may be accepted for processing after manual review.',\n    true\n  );\n\n  let newSnapshotRequestRateLimitAlert = htmlAlert(\n    'danger',\n    'The rate limit for \"take new snapshot\" requests has been reached. Please try again later.',\n    true\n  );\n\n  let newSnapshotRequestUnknownErrorAlert = htmlAlert(\n    'danger',\n    'An unexpected error happened when submitting the \"save code now request\".',\n    true\n  );\n\n  $(document).ready(() => {\n    $('#swh-take-new-snapshot-form').submit(event => {\n      event.preventDefault();\n      event.stopPropagation();\n\n      let originType = $('#swh-input-visit-type').val();\n      let originUrl = $('#swh-input-origin-url').val();\n\n      originSaveRequest(originType, originUrl,\n                        () => $('#swh-take-new-snapshot-request-status').html(newSnapshotRequestAcceptedAlert),\n                        () => $('#swh-take-new-snapshot-request-status').html(newSnapshotRequestPendingAlert),\n                        (statusCode, errorData) => {\n                          $('#swh-take-new-snapshot-request-status').css('color', 'red');\n                          if (statusCode === 403) {\n                            const errorAlert = htmlAlert('danger', `Error: ${errorData['detail']}`, true);\n                            $('#swh-take-new-snapshot-request-status').html(errorAlert);\n                          } else if (statusCode === 429) {\n                            $('#swh-take-new-snapshot-request-status').html(newSnapshotRequestRateLimitAlert);\n                          } else {\n                            $('#swh-take-new-snapshot-request-status').html(newSnapshotRequestUnknownErrorAlert);\n                          }\n                        });\n    });\n  });\n}\n\nexport function displaySaveRequestInfo(event, saveRequestId) {\n  event.stopPropagation();\n  const saveRequestTaskInfoUrl = Urls.origin_save_task_info(saveRequestId);\n  // close popover when clicking again on the info icon\n  if ($(event.target).data('bs.popover')) {\n    $(event.target).popover('dispose');\n    return;\n  }\n  $('.swh-save-request-info').popover('dispose');\n  $(event.target).popover({\n    animation: false,\n    boundary: 'viewport',\n    container: 'body',\n    title: 'Save request task information ' +\n             '<i style=\"cursor: pointer; position: absolute; right: 1rem;\" ' +\n             `class=\"mdi mdi-close swh-save-request-info-close\"></i>`,\n    content: `<div class=\"swh-popover swh-save-request-info-popover\">\n                  <div class=\"text-center\">\n                    <img src=${swhSpinnerSrc}></img>\n                    <p>Fetching task information ...</p>\n                  </div>\n                </div>`,\n    html: true,\n    placement: 'left',\n    sanitizeFn: swh.webapp.filterXSS\n  });\n\n  $(event.target).on('shown.bs.popover', function() {\n    const popoverId = $(this).attr('aria-describedby');\n    $(`#${popoverId} .mdi-close`).click(() => {\n      $(this).popover('dispose');\n    });\n  });\n\n  $(event.target).popover('show');\n  fetch(saveRequestTaskInfoUrl)\n    .then(response => response.json())\n    .then(saveRequestTaskInfo => {\n      let content;\n      if ($.isEmptyObject(saveRequestTaskInfo)) {\n        content = 'Not available';\n      } else {\n        let saveRequestInfo = [];\n        if (saveRequestTaskInfo.type) {\n          saveRequestInfo.push({\n            key: 'Task type',\n            value: saveRequestTaskInfo.type\n          });\n        }\n        if (saveRequestTaskInfo.arguments) {\n          saveRequestInfo.push({\n            key: 'Task arguments',\n            value: JSON.stringify(saveRequestTaskInfo.arguments, null, 2)\n          });\n        }\n        if (saveRequestTaskInfo.id) {\n          saveRequestInfo.push({\n            key: 'Task id',\n            value: saveRequestTaskInfo.id\n          });\n        }\n        if (saveRequestTaskInfo.backend_id) {\n          saveRequestInfo.push({\n            key: 'Task backend id',\n            value: saveRequestTaskInfo.backend_id\n          });\n        }\n        if (saveRequestTaskInfo.scheduled) {\n          saveRequestInfo.push({\n            key: 'Task scheduling date',\n            value: new Date(saveRequestTaskInfo.scheduled).toLocaleString()\n          });\n        }\n        if (saveRequestTaskInfo.started) {\n          saveRequestInfo.push({\n            key: 'Task start date',\n            value: new Date(saveRequestTaskInfo.started).toLocaleString()\n          });\n        }\n        if (saveRequestTaskInfo.ended) {\n          saveRequestInfo.push({\n            key: 'Task termination date',\n            value: new Date(saveRequestTaskInfo.ended).toLocaleString()\n          });\n        }\n        if (saveRequestTaskInfo.duration) {\n          saveRequestInfo.push({\n            key: 'Task duration',\n            value: saveRequestTaskInfo.duration + ' seconds'\n          });\n        }\n        if (saveRequestTaskInfo.worker) {\n          saveRequestInfo.push({\n            key: 'Task executor',\n            value: saveRequestTaskInfo.worker\n          });\n        }\n        if (saveRequestTaskInfo.message) {\n          saveRequestInfo.push({\n            key: 'Task log',\n            value: saveRequestTaskInfo.message\n          });\n        }\n        content = '<table class=\"table\"><tbody>';\n        for (let info of saveRequestInfo) {\n          content +=\n            `<tr>\n              <th class=\"swh-metadata-table-row swh-metadata-table-key\">${info.key}</th>\n              <td class=\"swh-metadata-table-row swh-metadata-table-value\">\n                <pre>${info.value}</pre>\n              </td>\n            </tr>`;\n        }\n        content += '</tbody></table>';\n      }\n      $('.swh-popover').html(content);\n      $(event.target).popover('update');\n    });\n}\n\nexport function fillSaveRequestFormAndScroll(visitType, originUrl) {\n  $('#swh-input-origin-url').val(originUrl);\n  let originTypeFound = false;\n  $('#swh-input-visit-type option').each(function() {\n    let val = $(this).val();\n    if (val && originUrl.includes(val)) {\n      $(this).prop('selected', true);\n      originTypeFound = true;\n    }\n  });\n  if (!originTypeFound) {\n    $('#swh-input-visit-type option').each(function() {\n      let val = $(this).val();\n      if (val === visitType) {\n        $(this).prop('selected', true);\n      }\n    });\n  }\n  window.scrollTo(0, 0);\n}\n","/**\n * Copyright (C) 2019  The Software Heritage developers\n * See the AUTHORS file at the top-level directory of this distribution\n * License: GNU Affero General Public License version 3, or any later version\n * See top-level LICENSE file for more information\n */\n\nimport {staticAsset} from 'utils/functions';\n\n// Constants defining Bootstrap Breakpoints\nexport const BREAKPOINT_SM = 768;\nexport const BREAKPOINT_MD = 992;\nexport const BREAKPOINT_LG = 1200;\n\nexport const swhSpinnerSrc = staticAsset('img/swh-spinner.gif');\n","/**\n * Copyright (C) 2018-2020  The Software Heritage developers\n * See the AUTHORS file at the top-level directory of this distribution\n * License: GNU Affero General Public License version 3, or any later version\n * See top-level LICENSE file for more information\n */\n\n// utility functions\n\nexport function handleFetchError(response) {\n  if (!response.ok) {\n    throw response;\n  }\n  return response;\n}\n\nexport function handleFetchErrors(responses) {\n  for (let i = 0; i < responses.length; ++i) {\n    if (!responses[i].ok) {\n      throw responses[i];\n    }\n  }\n  return responses;\n}\n\nexport function staticAsset(asset) {\n  return `${__STATIC__}${asset}`;\n}\n\nexport function csrfPost(url, headers = {}, body = null) {\n  headers['X-CSRFToken'] = Cookies.get('csrftoken');\n  return fetch(url, {\n    credentials: 'include',\n    headers: headers,\n    method: 'POST',\n    body: body\n  });\n}\n\nexport function isGitRepoUrl(url, pathPrefix = '/') {\n  let allowedProtocols = ['http:', 'https:', 'git:'];\n  if (allowedProtocols.find(protocol => protocol === url.protocol) === undefined) {\n    return false;\n  }\n  if (!url.pathname.startsWith(pathPrefix)) {\n    return false;\n  }\n  let re = new RegExp('[\\\\w\\\\.-]+\\\\/?(?!=.git)(?:\\\\.git\\\\/?)?$');\n  return re.test(url.pathname.slice(pathPrefix.length));\n};\n\nexport function removeUrlFragment() {\n  history.replaceState('', document.title, window.location.pathname + window.location.search);\n}\n\nexport function selectText(startNode, endNode) {\n  let selection = window.getSelection();\n  selection.removeAllRanges();\n  let range = document.createRange();\n  range.setStart(startNode, 0);\n  if (endNode.nodeName !== '#text') {\n    range.setEnd(endNode, endNode.childNodes.length);\n  } else {\n    range.setEnd(endNode, endNode.textContent.length);\n  }\n  selection.addRange(range);\n}\n\nexport function htmlAlert(type, message, closable = false) {\n  let closeButton = '';\n  let extraClasses = '';\n  if (closable) {\n    closeButton =\n      `<button type=\"button\" class=\"close\" data-dismiss=\"alert\" aria-label=\"Close\">\n        <span aria-hidden=\"true\">&times;</span>\n      </button>`;\n    extraClasses = 'alert-dismissible';\n  }\n  return `<div class=\"alert alert-${type} ${extraClasses}\" role=\"alert\">${message}${closeButton}</div>`;\n}\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tif(__webpack_module_cache__[moduleId]) {\n\t\treturn __webpack_module_cache__[moduleId].exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// module exports must be returned from runtime so entry inlining is disabled\n// startup\n// Load entry module and return exports\nreturn __webpack_require__(31184);\n","// define getter functions for harmony exports\n__webpack_require__.d = function(exports, definition) {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = function(obj, prop) { return Object.prototype.hasOwnProperty.call(obj, prop); }","// define __esModule on exports\n__webpack_require__.r = function(exports) {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};"],"sourceRoot":""}